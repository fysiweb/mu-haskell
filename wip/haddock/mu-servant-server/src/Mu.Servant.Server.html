<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# language ConstraintKinds       #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# language DataKinds             #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# language DeriveGeneric         #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# language FlexibleContexts      #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# language FlexibleInstances     #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# language GADTs                 #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# language MultiParamTypeClasses #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# language PolyKinds             #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# language RankNTypes            #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# language ScopedTypeVariables   #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# language TypeApplications      #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# language TypeFamilies          #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# language TypeOperators         #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# language UndecidableInstances  #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">{-|
Description : Execute a Mu 'Server' using Servant

This module allows you to serve a Mu 'Server'
as an OpenAPI / Swagger / REST end-point.
In particular, it translates to the kind of
type-level APIs used by Servant.
-}</span><span>
</span><span id="line-24"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Mu.Servant.Server</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Convert Mu to Servant</span></span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#servantServerHandlers"><span class="hs-identifier">servantServerHandlers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#servantServerHandlersExtra"><span class="hs-identifier">servantServerHandlersExtra</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#toHandler"><span class="hs-identifier">toHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#packageAPI"><span class="hs-identifier">packageAPI</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#swagger"><span class="hs-identifier">swagger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Required annotations</span></span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier">ServantRoute</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#DefaultServantContentTypes"><span class="hs-identifier">DefaultServantContentTypes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier">ServantContentTypes</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#ServantStreamContentType"><span class="hs-identifier">ServantStreamContentType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-comment">-- Reexports</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><span class="hs-identifier">StdMethod</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-keyword">module</span><span> </span><span class="annot"><span class="hs-identifier">Servant.API</span></span><span>
</span><span id="line-39"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Conduit</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy.UTF8</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LB8</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Conduit.Internal</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ConduitT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Pipe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Swagger</span></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Swagger</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToSchema</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">GHC.Types</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Any</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Generics.Generic.Aeson</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Mu.Rpc</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Mu.Rpc.Annotations</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Mu.Schema</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Mu.Schema.Annotations</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Mu.Server</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Servant</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Servant.API</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Servant.Swagger</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Servant.Types.SourceT</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- | Reinterprets a Mu server action as a Servant handler.</span><span>
</span><span id="line-65"></span><span id="local-6989586621679149794"><span class="annot"><a href="Mu.Servant.Server.html#toHandler"><span class="hs-identifier hs-type">toHandler</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerErrorIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679149794"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679149794"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-66"></span><span id="toHandler"><span class="annot"><span class="annottext">toHandler :: ServerErrorIO a -&gt; Handler a
</span><a href="Mu.Servant.Server.html#toHandler"><span class="hs-identifier hs-var hs-var">toHandler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT ServerError IO a -&gt; Handler a
forall a. ExceptT ServerError IO a -&gt; Handler a
</span><span class="hs-identifier hs-var">Handler</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT ServerError IO a -&gt; Handler a)
-&gt; (ServerErrorIO a -&gt; ExceptT ServerError IO a)
-&gt; ServerErrorIO a
-&gt; Handler a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; ServerError)
-&gt; ServerErrorIO a -&gt; ExceptT ServerError IO a
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ServerError
</span><a href="Mu.Servant.Server.html#convertServerError"><span class="hs-identifier hs-var">convertServerError</span></a></span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="hs-comment">-- | Translates a Mu `Mu.Server.ServerError` into a Servant `Servant.ServerError`.</span><span>
</span><span id="line-69"></span><span class="annot"><a href="Mu.Servant.Server.html#convertServerError"><span class="hs-identifier hs-type">convertServerError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Mu.Server.ServerError</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Servant.ServerError</span></span><span>
</span><span id="line-70"></span><span id="convertServerError"><span class="annot"><span class="annottext">convertServerError :: ServerError -&gt; ServerError
</span><a href="Mu.Servant.Server.html#convertServerError"><span class="hs-identifier hs-var hs-var">convertServerError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Mu.Server.ServerError</span></span><span> </span><span id="local-6989586621679149788"><span class="annot"><span class="annottext">ServerErrorCode
</span><a href="#local-6989586621679149788"><span class="hs-identifier hs-var">code</span></a></span></span><span> </span><span id="local-6989586621679149787"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149787"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ServerErrorCode
</span><a href="#local-6989586621679149788"><span class="hs-identifier hs-var">code</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><span class="annottext">ServerErrorCode
</span><span class="hs-identifier hs-var">Unknown</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err502</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">LB8.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149787"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="annottext">ServerErrorCode
</span><span class="hs-identifier hs-var">Unavailable</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err503</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">LB8.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149787"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="annottext">ServerErrorCode
</span><span class="hs-identifier hs-var">Unimplemented</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err501</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">LB8.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149787"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="annottext">ServerErrorCode
</span><span class="hs-identifier hs-var">Unauthenticated</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err401</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">LB8.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149787"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="annottext">ServerErrorCode
</span><span class="hs-identifier hs-var">Internal</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err500</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">LB8.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149787"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><span class="annottext">ServerErrorCode
</span><span class="hs-identifier hs-var">Invalid</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err400</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">LB8.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149787"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><span class="annottext">ServerErrorCode
</span><span class="hs-identifier hs-var">NotFound</span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServerError
</span><span class="hs-identifier hs-var">err404</span></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">errBody :: ByteString
</span><span class="hs-identifier hs-var">errBody</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ByteString
</span><span class="hs-identifier hs-var">LB8.fromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149787"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | Converts a Mu server into Servant server</span><span>
</span><span id="line-80"></span><span class="hs-comment">--   by running all Mu handler actions in the `Handler` type.</span><span>
</span><span id="line-81"></span><span class="hs-comment">--   This version assumes /no/ additional routes</span><span>
</span><span id="line-82"></span><span class="hs-comment">--   in the Servant server when compared to Mu's.</span><span>
</span><span id="line-83"></span><span class="annot"><a href="Mu.Servant.Server.html#servantServerHandlers"><span class="hs-identifier hs-type">servantServerHandlers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679149770"><span class="annot"><a href="#local-6989586621679149770"><span class="hs-identifier hs-type">pname</span></a></span></span><span> </span><span id="local-6989586621679149769"><span class="annot"><a href="#local-6989586621679149769"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679149768"><span class="annot"><a href="#local-6989586621679149768"><span class="hs-identifier hs-type">chn</span></a></span></span><span> </span><span id="local-6989586621679149767"><span class="annot"><a href="#local-6989586621679149767"><span class="hs-identifier hs-type">ss</span></a></span></span><span> </span><span id="local-6989586621679149766"><span class="annot"><a href="#local-6989586621679149766"><span class="hs-identifier hs-type">handlers</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantServiceHandlers"><span class="hs-identifier hs-type">ServantServiceHandlers</span></a></span><span>
</span><span id="line-86"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149770"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149767"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>      </span><span class="annot"><a href="#local-6989586621679149769"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><a href="#local-6989586621679149768"><span class="hs-identifier hs-type">chn</span></a></span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><a href="#local-6989586621679149767"><span class="hs-identifier hs-type">ss</span></a></span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><a href="#local-6989586621679149766"><span class="hs-identifier hs-type">handlers</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ExtraFor"><span class="hs-identifier hs-type">ExtraFor</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149770"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149767"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span>&#160;</span><span class="annot"><span class="hs-identifier hs-type">EmptyAPI</span></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679150140"><span class="annot"><a href="#local-6989586621679150140"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679149769"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150140"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679150140"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ how to turn the inner Mu monad into 'Handler', use 'toHandler' (or a composition with it) in most cases</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Mu.Server.ServerT</span></span><span> </span><span class="annot"><a href="#local-6989586621679149768"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149770"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149767"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149769"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149766"><span class="hs-identifier hs-type">handlers</span></a></span><span>  </span><span class="hs-comment">-- ^ server to be converted</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Servant.Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#PackageAPI"><span class="hs-identifier hs-type">PackageAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149770"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149767"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149766"><span class="hs-identifier hs-type">handlers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span id="servantServerHandlers"><span class="annot"><span class="annottext">servantServerHandlers :: (forall a. m a -&gt; Handler a)
-&gt; ServerT chn () ('Package pname ss) m handlers
-&gt; Server (PackageAPI ('Package pname ss) handlers)
</span><a href="Mu.Servant.Server.html#servantServerHandlers"><span class="hs-identifier hs-var hs-var">servantServerHandlers</span></a></span></span><span> </span><span id="local-6989586621679149765"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149765"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Services</span></span><span> </span><span id="local-6989586621679149763"><span class="annot"><span class="annottext">ServicesT chn () s1 m handlers
</span><a href="#local-6989586621679149763"><span class="hs-identifier hs-var">svcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="annottext">Tagged Handler EmptyServer
forall (m :: * -&gt; *). ServerT EmptyAPI m
</span><span class="hs-identifier hs-var">emptyServer</span></span><span> </span><span class="annot"><span class="annottext">Tagged Handler EmptyServer
-&gt; ServerT (ServicesAPI ('Package pname ss) ss handlers) Handler
-&gt; Tagged Handler EmptyServer
   :&lt;|&gt; ServerT (ServicesAPI ('Package pname ss) ss handlers) Handler
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Handler a)
-&gt; Proxy ('Package pname ss)
-&gt; ServicesT chn () s1 m handlers
-&gt; Server (ServicesAPI ('Package pname ss) s1 handlers)
forall snm mnm anm (pkg :: Package snm mnm anm (TypeRef snm))
       (m :: * -&gt; *) (chn :: ServiceChain snm)
       (ss :: [Service snm mnm anm (TypeRef snm)]) (hss :: [[*]]) info.
ServantServiceHandlers pkg m chn ss hss =&gt;
(forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; ServicesT chn info ss m hss
-&gt; Server (ServicesAPI pkg ss hss)
</span><a href="Mu.Servant.Server.html#servantServiceHandlers"><span class="hs-identifier hs-var">servantServiceHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149765"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ('Package pname ss)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149770"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149767"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ServicesT chn () s1 m handlers
</span><a href="#local-6989586621679149763"><span class="hs-identifier hs-var">svcs</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- | Converts a Mu server into Servant server</span><span>
</span><span id="line-100"></span><span class="hs-comment">--   by running all Mu handler actions in the `Handler` type.</span><span>
</span><span id="line-101"></span><span class="hs-comment">--   This version should be used when additional</span><span>
</span><span id="line-102"></span><span class="hs-comment">--   routes have been added in the Servant version.</span><span>
</span><span id="line-103"></span><span class="annot"><a href="Mu.Servant.Server.html#servantServerHandlersExtra"><span class="hs-identifier hs-type">servantServerHandlersExtra</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679149758"><span class="annot"><a href="#local-6989586621679149758"><span class="hs-identifier hs-type">pname</span></a></span></span><span> </span><span id="local-6989586621679149757"><span class="annot"><a href="#local-6989586621679149757"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679149756"><span class="annot"><a href="#local-6989586621679149756"><span class="hs-identifier hs-type">chn</span></a></span></span><span> </span><span id="local-6989586621679149755"><span class="annot"><a href="#local-6989586621679149755"><span class="hs-identifier hs-type">ss</span></a></span></span><span> </span><span id="local-6989586621679149754"><span class="annot"><a href="#local-6989586621679149754"><span class="hs-identifier hs-type">handlers</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantServiceHandlers"><span class="hs-identifier hs-type">ServantServiceHandlers</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149758"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149755"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>      </span><span class="annot"><a href="#local-6989586621679149757"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><a href="#local-6989586621679149756"><span class="hs-identifier hs-type">chn</span></a></span><span>
</span><span id="line-109"></span><span>      </span><span class="annot"><a href="#local-6989586621679149755"><span class="hs-identifier hs-type">ss</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><a href="#local-6989586621679149754"><span class="hs-identifier hs-type">handlers</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679150098"><span class="annot"><a href="#local-6989586621679150098"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679149757"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150098"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679150098"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ how to turn the inner Mu monad into 'Handler', use 'toHandler' (or a composition with it) in most cases</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#ExtraFor"><span class="hs-identifier hs-type">ExtraFor</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149758"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149755"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ additional handler for the extra route</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Mu.Server.ServerT</span></span><span> </span><span class="annot"><a href="#local-6989586621679149756"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149758"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149755"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149757"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149754"><span class="hs-identifier hs-type">handlers</span></a></span><span>  </span><span class="hs-comment">-- ^ server to be converted</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Servant.Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#PackageAPI"><span class="hs-identifier hs-type">PackageAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149758"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149755"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149754"><span class="hs-identifier hs-type">handlers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span id="servantServerHandlersExtra"><span class="annot"><span class="annottext">servantServerHandlersExtra :: (forall a. m a -&gt; Handler a)
-&gt; Server (ExtraFor ('Package pname ss))
-&gt; ServerT chn () ('Package pname ss) m handlers
-&gt; Server (PackageAPI ('Package pname ss) handlers)
</span><a href="Mu.Servant.Server.html#servantServerHandlersExtra"><span class="hs-identifier hs-var hs-var">servantServerHandlersExtra</span></a></span></span><span> </span><span id="local-6989586621679149753"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149753"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679149752"><span class="annot"><span class="annottext">Server (ExtraFor ('Package pname ss))
</span><a href="#local-6989586621679149752"><span class="hs-identifier hs-var">extra</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Services</span></span><span> </span><span id="local-6989586621679149751"><span class="annot"><span class="annottext">ServicesT chn () s1 m handlers
</span><a href="#local-6989586621679149751"><span class="hs-identifier hs-var">svcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><span class="annottext">Server (ExtraFor ('Package pname ss))
ServerT
  (WithAnnotatedPackageInstance
     ServantRoute
     ('Package pname ss)
     (UnwrapServantExtra
        (FromMaybe
           ('ServantAdditional EmptyAPI)
           (GetPackageAnnotationMay
              (AnnotatedPackage ServantRoute ('Package pname ss))))))
  Handler
</span><a href="#local-6989586621679149752"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="annot"><span class="annottext">ServerT
  (WithAnnotatedPackageInstance
     ServantRoute
     ('Package pname ss)
     (UnwrapServantExtra
        (FromMaybe
           ('ServantAdditional EmptyAPI)
           (GetPackageAnnotationMay
              (AnnotatedPackage ServantRoute ('Package pname ss))))))
  Handler
-&gt; ServerT (ServicesAPI ('Package pname ss) ss handlers) Handler
-&gt; ServerT
     (WithAnnotatedPackageInstance
        ServantRoute
        ('Package pname ss)
        (UnwrapServantExtra
           (FromMaybe
              ('ServantAdditional EmptyAPI)
              (GetPackageAnnotationMay
                 (AnnotatedPackage ServantRoute ('Package pname ss))))))
     Handler
   :&lt;|&gt; ServerT (ServicesAPI ('Package pname ss) ss handlers) Handler
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Handler a)
-&gt; Proxy ('Package pname ss)
-&gt; ServicesT chn () s1 m handlers
-&gt; Server (ServicesAPI ('Package pname ss) s1 handlers)
forall snm mnm anm (pkg :: Package snm mnm anm (TypeRef snm))
       (m :: * -&gt; *) (chn :: ServiceChain snm)
       (ss :: [Service snm mnm anm (TypeRef snm)]) (hss :: [[*]]) info.
ServantServiceHandlers pkg m chn ss hss =&gt;
(forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; ServicesT chn info ss m hss
-&gt; Server (ServicesAPI pkg ss hss)
</span><a href="Mu.Servant.Server.html#servantServiceHandlers"><span class="hs-identifier hs-var">servantServiceHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149753"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ('Package pname ss)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149758"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149755"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ServicesT chn () s1 m handlers
</span><a href="#local-6989586621679149751"><span class="hs-identifier hs-var">svcs</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- | Converts the information from a Mu server</span><span>
</span><span id="line-120"></span><span class="hs-comment">--   into a 'Swagger' document.</span><span>
</span><span id="line-121"></span><span class="annot"><a href="Mu.Servant.Server.html#swagger"><span class="hs-identifier hs-type">swagger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679149750"><span class="annot"><a href="#local-6989586621679149750"><span class="hs-identifier hs-type">pname</span></a></span></span><span> </span><span id="local-6989586621679149749"><span class="annot"><a href="#local-6989586621679149749"><span class="hs-identifier hs-type">ss</span></a></span></span><span> </span><span id="local-6989586621679149748"><span class="annot"><a href="#local-6989586621679149748"><span class="hs-identifier hs-type">handlers</span></a></span></span><span> </span><span id="local-6989586621679149747"><span class="annot"><a href="#local-6989586621679149747"><span class="hs-identifier hs-type">chn</span></a></span></span><span> </span><span id="local-6989586621679149746"><span class="annot"><a href="#local-6989586621679149746"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-122"></span><span>           </span><span class="annot"><span class="hs-identifier hs-type">HasSwagger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#ServicesAPI"><span class="hs-identifier hs-type">ServicesAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149750"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149749"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149749"><span class="hs-identifier hs-type">ss</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149748"><span class="hs-identifier hs-type">handlers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Mu.Server.ServerT</span></span><span> </span><span class="annot"><a href="#local-6989586621679149747"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149750"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149749"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149746"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149748"><span class="hs-identifier hs-type">handlers</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Swagger</span></span><span>
</span><span id="line-125"></span><span id="swagger"><span class="annot"><span class="annottext">swagger :: ServerT chn () ('Package pname ss) m handlers -&gt; Swagger
</span><a href="Mu.Servant.Server.html#swagger"><span class="hs-identifier hs-var hs-var">swagger</span></a></span></span><span> </span><span class="annot"><span class="annottext">ServerT chn () ('Package pname ss) m handlers
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy (ServicesAPI ('Package pname ss) ss handlers) -&gt; Swagger
forall k (api :: k). HasSwagger api =&gt; Proxy api -&gt; Swagger
</span><span class="hs-identifier hs-var">toSwagger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy (ServicesAPI ('Package pname ss) ss handlers)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#ServicesAPI"><span class="hs-identifier hs-type">ServicesAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149750"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149749"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149749"><span class="hs-identifier hs-type">ss</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149748"><span class="hs-identifier hs-type">handlers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- | Obtains a Servant API 'Proxy' value for use</span><span>
</span><span id="line-128"></span><span class="hs-comment">--   with functions like 'serve' and 'layout'.</span><span>
</span><span id="line-129"></span><span id="local-6989586621679149740"><span id="local-6989586621679149741"><span id="local-6989586621679149742"><span id="local-6989586621679149743"><span id="local-6989586621679149744"><span class="annot"><a href="Mu.Servant.Server.html#packageAPI"><span class="hs-identifier hs-type">packageAPI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Mu.Server.ServerT</span></span><span> </span><span class="annot"><a href="#local-6989586621679149744"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149743"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149742"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149741"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149740"><span class="hs-identifier hs-type">handlers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#PackageAPI"><span class="hs-identifier hs-type">PackageAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149742"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149740"><span class="hs-identifier hs-type">handlers</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-130"></span><span id="packageAPI"><span class="annot"><span class="annottext">packageAPI :: ServerT chn t pkg s handlers -&gt; Proxy (PackageAPI pkg handlers)
</span><a href="Mu.Servant.Server.html#packageAPI"><span class="hs-identifier hs-var hs-var">packageAPI</span></a></span></span><span> </span><span class="annot"><span class="annottext">ServerT chn t pkg s handlers
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy (PackageAPI pkg handlers)
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="PackageAPI"><span class="annot"><a href="Mu.Servant.Server.html#PackageAPI"><span class="hs-identifier hs-var">PackageAPI</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149739"><span class="annot"><a href="#local-6989586621679149739"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span id="local-6989586621679149738"><span class="annot"><a href="#local-6989586621679149738"><span class="hs-identifier hs-type hs-type">snm</span></a></span></span><span> </span><span id="local-6989586621679149737"><span class="annot"><a href="#local-6989586621679149737"><span class="hs-identifier hs-type hs-type">mnm</span></a></span></span><span> </span><span id="local-6989586621679149736"><span class="annot"><a href="#local-6989586621679149736"><span class="hs-identifier hs-type hs-type">anm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679149738"><span class="hs-identifier hs-type">snm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679149735"><span class="annot"><a href="#local-6989586621679149735"><span class="hs-identifier hs-type">handlers</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-133"></span><span>  </span><span id="PackageAPI"><span class="annot"><a href="Mu.Servant.Server.html#PackageAPI"><span class="hs-identifier hs-var">PackageAPI</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span id="local-6989586621679149734"><span class="annot"><a href="#local-6989586621679149734"><span class="hs-identifier hs-type hs-type">pnm</span></a></span></span><span> </span><span id="local-6989586621679149733"><span class="annot"><a href="#local-6989586621679149733"><span class="hs-identifier hs-type hs-type">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679149732"><span class="annot"><a href="#local-6989586621679149732"><span class="hs-identifier hs-type hs-type">handlers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#PackageAPI%27"><span class="hs-identifier hs-type">PackageAPI'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#ExtraFor"><span class="hs-identifier hs-type">ExtraFor</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149734"><span class="hs-identifier hs-type">pnm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149733"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149734"><span class="hs-identifier hs-type">pnm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149733"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149732"><span class="hs-identifier hs-type">handlers</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="PackageAPI%27"><span class="annot"><a href="Mu.Servant.Server.html#PackageAPI%27"><span class="hs-identifier hs-var">PackageAPI'</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149730"><span class="annot"><a href="#local-6989586621679149730"><span class="hs-identifier hs-type">extra</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149729"><span class="annot"><a href="#local-6989586621679149729"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span id="local-6989586621679149728"><span class="annot"><a href="#local-6989586621679149728"><span class="hs-identifier hs-type hs-type">snm</span></a></span></span><span> </span><span id="local-6989586621679149727"><span class="annot"><a href="#local-6989586621679149727"><span class="hs-identifier hs-type hs-type">mnm</span></a></span></span><span> </span><span id="local-6989586621679149726"><span class="annot"><a href="#local-6989586621679149726"><span class="hs-identifier hs-type hs-type">anm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679149728"><span class="hs-identifier hs-type">snm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679149725"><span class="annot"><a href="#local-6989586621679149725"><span class="hs-identifier hs-type">handlers</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-136"></span><span>  </span><span id="PackageAPI%27"><span class="annot"><a href="Mu.Servant.Server.html#PackageAPI%27"><span class="hs-identifier hs-var">PackageAPI'</span></a></span></span><span> </span><span id="local-6989586621679149724"><span class="annot"><a href="#local-6989586621679149724"><span class="hs-identifier hs-type hs-type">extra</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span id="local-6989586621679149723"><span class="annot"><a href="#local-6989586621679149723"><span class="hs-identifier hs-type hs-type">pnm</span></a></span></span><span> </span><span id="local-6989586621679149722"><span class="annot"><a href="#local-6989586621679149722"><span class="hs-identifier hs-type hs-type">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679149721"><span class="annot"><a href="#local-6989586621679149721"><span class="hs-identifier hs-type hs-type">handlers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149724"><span class="hs-identifier hs-type">extra</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServicesAPI"><span class="hs-identifier hs-type">ServicesAPI</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><a href="#local-6989586621679149723"><span class="hs-identifier hs-type">pnm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149722"><span class="hs-identifier hs-type">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149722"><span class="hs-identifier hs-type">ss</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149721"><span class="hs-identifier hs-type">handlers</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-keyword">class</span><span>
</span><span id="line-139"></span><span>  </span><span id="ServantServiceHandlers"><span class="annot"><a href="Mu.Servant.Server.html#ServantServiceHandlers"><span class="hs-identifier hs-var">ServantServiceHandlers</span></a></span></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150109"><span class="annot"><a href="#local-6989586621679150109"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span id="local-6989586621679150114"><span class="annot"><a href="#local-6989586621679150114"><span class="hs-identifier hs-type hs-type">snm</span></a></span></span><span> </span><span id="local-6989586621679150113"><span class="annot"><a href="#local-6989586621679150113"><span class="hs-identifier hs-type hs-type">mnm</span></a></span></span><span> </span><span id="local-6989586621679150112"><span class="annot"><a href="#local-6989586621679150112"><span class="hs-identifier hs-type hs-type">anm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679150114"><span class="hs-identifier hs-type">snm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150108"><span class="annot"><a href="#local-6989586621679150108"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150107"><span class="annot"><a href="#local-6989586621679150107"><span class="hs-identifier hs-type">chn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServiceChain</span></span><span> </span><span class="annot"><a href="#local-6989586621679150114"><span class="hs-identifier hs-type">snm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150106"><span class="annot"><a href="#local-6989586621679150106"><span class="hs-identifier hs-type">ss</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Service</span></span><span> </span><span class="annot"><a href="#local-6989586621679150114"><span class="hs-identifier hs-type">snm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150113"><span class="hs-identifier hs-type">mnm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150112"><span class="hs-identifier hs-type">anm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679150114"><span class="hs-identifier hs-type">snm</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150105"><span class="annot"><a href="#local-6989586621679150105"><span class="hs-identifier hs-type">hss</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ServicesAPI"><span class="annot"><a href="Mu.Servant.Server.html#ServicesAPI"><span class="hs-identifier hs-var">ServicesAPI</span></a></span></span><span> </span><span id="local-6989586621679150109"><span class="annot"><a href="#local-6989586621679150109"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679150106"><span class="annot"><a href="#local-6989586621679150106"><span class="hs-identifier hs-type">ss</span></a></span></span><span> </span><span id="local-6989586621679150105"><span class="annot"><a href="#local-6989586621679150105"><span class="hs-identifier hs-type">hss</span></a></span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>  </span><span id="local-6989586621679150102"><span id="servantServiceHandlers"><span class="annot"><a href="Mu.Servant.Server.html#servantServiceHandlers"><span class="hs-identifier hs-type">servantServiceHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679150103"><span class="annot"><a href="#local-6989586621679150103"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679150108"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150103"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679150103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679150109"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ServicesT</span></span><span> </span><span class="annot"><a href="#local-6989586621679150107"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150102"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150106"><span class="hs-identifier hs-type">ss</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150108"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150105"><span class="hs-identifier hs-type">hss</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Servant.Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#ServicesAPI"><span class="hs-identifier hs-type">ServicesAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150109"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150106"><span class="hs-identifier hs-type">ss</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150105"><span class="hs-identifier hs-type">hss</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span id="local-6989586621679149718"><span id="local-6989586621679149719"><span id="local-6989586621679149720"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantServiceHandlers"><span class="hs-identifier hs-type">ServantServiceHandlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149720"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149719"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149718"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ServicesAPI"><span class="annot"><a href="Mu.Servant.Server.html#ServicesAPI"><span class="hs-identifier hs-var">ServicesAPI</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149720"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EmptyAPI</span></span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621679149715"><span class="annot"><span class="annottext">servantServiceHandlers :: (forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; ServicesT chn info '[] m '[]
-&gt; Server (ServicesAPI pkg '[] '[])
</span><a href="#local-6989586621679149715"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantServiceHandlers</span></a></span></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy pkg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ServicesT chn info '[] m '[]
</span><span class="hs-identifier hs-var">S0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Server (ServicesAPI pkg '[] '[])
forall (m :: * -&gt; *). ServerT EmptyAPI m
</span><span class="hs-identifier hs-var">emptyServer</span></span></span></span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span id="local-6989586621679149706"><span id="local-6989586621679149707"><span id="local-6989586621679149708"><span id="local-6989586621679149709"><span id="local-6989586621679149710"><span id="local-6989586621679149711"><span id="local-6989586621679149712"><span id="local-6989586621679149713"><span class="hs-keyword">instance</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandlers"><span class="hs-identifier hs-type">ServantMethodHandlers</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="annot"><a href="#local-6989586621679149713"><span class="hs-identifier hs-type">pkg</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span class="annot"><a href="#local-6989586621679149712"><span class="hs-identifier hs-type">sname</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="annot"><a href="#local-6989586621679149711"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><a href="#local-6989586621679149710"><span class="hs-identifier hs-type">chn</span></a></span><span>
</span><span id="line-163"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MappingRight</span></span><span> </span><span class="annot"><a href="#local-6989586621679149710"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149712"><span class="hs-identifier hs-type">sname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>      </span><span class="annot"><a href="#local-6989586621679149709"><span class="hs-identifier hs-type">methods</span></a></span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><a href="#local-6989586621679149708"><span class="hs-identifier hs-type">hs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#ServantServiceHandlers"><span class="hs-identifier hs-type">ServantServiceHandlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149713"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149711"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149710"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149707"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149706"><span class="hs-identifier hs-type">hss</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#ServantServiceHandlers"><span class="hs-identifier hs-type">ServantServiceHandlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149713"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149711"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149710"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Service</span></span><span> </span><span class="annot"><a href="#local-6989586621679149712"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149709"><span class="hs-identifier hs-type">methods</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149707"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149708"><span class="hs-identifier hs-type">hs</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149706"><span class="hs-identifier hs-type">hss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-171"></span><span>    </span><span id="ServicesAPI"><span class="annot"><a href="Mu.Servant.Server.html#ServicesAPI"><span class="hs-identifier hs-var">ServicesAPI</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149713"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Service</span></span><span> </span><span class="annot"><a href="#local-6989586621679149712"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149709"><span class="hs-identifier hs-type">methods</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149707"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149708"><span class="hs-identifier hs-type">hs</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149706"><span class="hs-identifier hs-type">hss</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><a href="Mu.Servant.Server.html#MethodsAPI"><span class="hs-identifier hs-type">MethodsAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149713"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149712"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149709"><span class="hs-identifier hs-type">methods</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149708"><span class="hs-identifier hs-type">hs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServicesAPI"><span class="hs-identifier hs-type">ServicesAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149713"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149707"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149706"><span class="hs-identifier hs-type">hss</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621679149704"><span class="annot"><span class="annottext">servantServiceHandlers :: (forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; ServicesT chn info ('Service sname methods : rest) m (hs : hss)
-&gt; Server
     (ServicesAPI pkg ('Service sname methods : rest) (hs : hss))
</span><a href="#local-6989586621679149704"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantServiceHandlers</span></a></span></span><span> </span><span id="local-6989586621679149703"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149703"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679149702"><span class="annot"><span class="annottext">Proxy pkg
</span><a href="#local-6989586621679149702"><span class="hs-identifier hs-var">pkgP</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ProperSvc</span></span><span> </span><span id="local-6989586621679149700"><span class="annot"><span class="annottext">HandlersT chn info (MappingRight chn sname) methods m hs1
</span><a href="#local-6989586621679149700"><span class="hs-identifier hs-var">svr</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;&amp;&gt;:</span></span><span> </span><span id="local-6989586621679149698"><span class="annot"><span class="annottext">ServicesT chn info rest m hss
</span><a href="#local-6989586621679149698"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; Proxy sname
-&gt; HandlersT chn info (MappingRight chn sname) methods m hs1
-&gt; Server (MethodsAPI pkg sname methods hs1)
forall anm snm (pkg :: Package Symbol Symbol anm (TypeRef Symbol))
       (sname :: Symbol) (m :: * -&gt; *) (chn :: ServiceChain snm) inh
       (ms :: [Method snm Symbol anm (TypeRef snm)]) (hs :: [*]) info.
ServantMethodHandlers pkg sname m chn inh ms hs =&gt;
(forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; Proxy sname
-&gt; HandlersT chn info inh ms m hs
-&gt; Server (MethodsAPI pkg sname ms hs)
</span><a href="Mu.Servant.Server.html#servantMethodHandlers"><span class="hs-identifier hs-var">servantMethodHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149703"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy pkg
</span><a href="#local-6989586621679149702"><span class="hs-identifier hs-var">pkgP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy sname
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679149712"><span class="hs-identifier hs-type">sname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HandlersT chn info (MappingRight chn sname) methods m hs1
HandlersT chn info (MappingRight chn sname) methods m hs1
</span><a href="#local-6989586621679149700"><span class="hs-identifier hs-var">svr</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="annot"><span class="annottext">ServerT (MethodsAPI pkg sname methods hs) Handler
-&gt; ServerT (ServicesAPI pkg rest hss) Handler
-&gt; ServerT (MethodsAPI pkg sname methods hs) Handler
   :&lt;|&gt; ServerT (ServicesAPI pkg rest hss) Handler
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; ServicesT chn info rest m hss
-&gt; Server (ServicesAPI pkg rest hss)
forall snm mnm anm (pkg :: Package snm mnm anm (TypeRef snm))
       (m :: * -&gt; *) (chn :: ServiceChain snm)
       (ss :: [Service snm mnm anm (TypeRef snm)]) (hss :: [[*]]) info.
ServantServiceHandlers pkg m chn ss hss =&gt;
(forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; ServicesT chn info ss m hss
-&gt; Server (ServicesAPI pkg ss hss)
</span><a href="Mu.Servant.Server.html#servantServiceHandlers"><span class="hs-identifier hs-var">servantServiceHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149703"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy pkg
</span><a href="#local-6989586621679149702"><span class="hs-identifier hs-var">pkgP</span></a></span><span> </span><span class="annot"><span class="annottext">ServicesT chn info rest m hss
</span><a href="#local-6989586621679149698"><span class="hs-identifier hs-var">rest</span></a></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span id="local-6989586621679149690"><span id="local-6989586621679149691"><span id="local-6989586621679149692"><span id="local-6989586621679149693"><span id="local-6989586621679149694"><span id="local-6989586621679149695"><span id="local-6989586621679149696"><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;unions are not supported by Servant servers&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>         </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantServiceHandlers"><span class="hs-identifier hs-type">ServantServiceHandlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149696"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149695"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149694"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">OneOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679149693"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149692"><span class="hs-identifier hs-type">methods</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149691"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149690"><span class="hs-identifier hs-type">hs</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ServicesAPI"><span class="annot"><a href="Mu.Servant.Server.html#ServicesAPI"><span class="hs-identifier hs-var">ServicesAPI</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149696"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">OneOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679149693"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149692"><span class="hs-identifier hs-type">methods</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149691"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149690"><span class="hs-identifier hs-type">hs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;unions are not supported by Servant servers&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621679149688"><span class="annot"><span class="annottext">servantServiceHandlers :: (forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; ServicesT chn info ('OneOf sname methods : rest) m hs
-&gt; Server (ServicesAPI pkg ('OneOf sname methods : rest) hs)
</span><a href="#local-6989586621679149688"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantServiceHandlers</span></a></span></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Proxy pkg
-&gt; ServicesT chn info ('OneOf sname methods : rest) m hs
-&gt; ServerT (TypeError ...) Handler
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unions are not supported by Servant servers&quot;</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-keyword">class</span><span>
</span><span id="line-184"></span><span>  </span><span id="ServantMethodHandlers"><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandlers"><span class="hs-identifier hs-var">ServantMethodHandlers</span></a></span></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150029"><span class="annot"><a href="#local-6989586621679150029"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span id="local-6989586621679150031"><span class="annot"><a href="#local-6989586621679150031"><span class="hs-identifier hs-type hs-type">anm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150028"><span class="annot"><a href="#local-6989586621679150028"><span class="hs-identifier hs-type">sname</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150027"><span class="annot"><a href="#local-6989586621679150027"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150026"><span class="annot"><a href="#local-6989586621679150026"><span class="hs-identifier hs-type">chn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServiceChain</span></span><span> </span><span id="local-6989586621679150030"><span class="annot"><a href="#local-6989586621679150030"><span class="hs-identifier hs-type hs-type">snm</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150025"><span class="annot"><a href="#local-6989586621679150025"><span class="hs-identifier hs-type">inh</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150024"><span class="annot"><a href="#local-6989586621679150024"><span class="hs-identifier hs-type">ms</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679150030"><span class="hs-identifier hs-type">snm</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><a href="#local-6989586621679150031"><span class="hs-identifier hs-type">anm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679150030"><span class="hs-identifier hs-type">snm</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679150023"><span class="annot"><a href="#local-6989586621679150023"><span class="hs-identifier hs-type">hs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="MethodsAPI"><span class="annot"><a href="Mu.Servant.Server.html#MethodsAPI"><span class="hs-identifier hs-var">MethodsAPI</span></a></span></span><span> </span><span id="local-6989586621679150029"><span class="annot"><a href="#local-6989586621679150029"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679150028"><span class="annot"><a href="#local-6989586621679150028"><span class="hs-identifier hs-type">sname</span></a></span></span><span> </span><span id="local-6989586621679150024"><span class="annot"><a href="#local-6989586621679150024"><span class="hs-identifier hs-type">ms</span></a></span></span><span> </span><span id="local-6989586621679150023"><span class="annot"><a href="#local-6989586621679150023"><span class="hs-identifier hs-type">hs</span></a></span></span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621679150021"><span id="servantMethodHandlers"><span class="annot"><a href="Mu.Servant.Server.html#servantMethodHandlers"><span class="hs-identifier hs-type">servantMethodHandlers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679150022"><span class="annot"><a href="#local-6989586621679150022"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679150027"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150022"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679150022"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679150029"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679150028"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HandlersT</span></span><span> </span><span class="annot"><a href="#local-6989586621679150026"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150021"><span class="hs-identifier hs-type">info</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150025"><span class="hs-identifier hs-type">inh</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150024"><span class="hs-identifier hs-type">ms</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150027"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150023"><span class="hs-identifier hs-type">hs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Servant.Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#MethodsAPI"><span class="hs-identifier hs-type">MethodsAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150029"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150028"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150024"><span class="hs-identifier hs-type">ms</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679150023"><span class="hs-identifier hs-type">hs</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span id="local-6989586621679149682"><span id="local-6989586621679149683"><span id="local-6989586621679149684"><span id="local-6989586621679149685"><span id="local-6989586621679149686"><span class="hs-keyword">instance</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandlers"><span class="hs-identifier hs-type">ServantMethodHandlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149686"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149685"><span class="hs-identifier hs-type">svc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149684"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149683"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149682"><span class="hs-identifier hs-type">inh</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="MethodsAPI"><span class="annot"><a href="Mu.Servant.Server.html#MethodsAPI"><span class="hs-identifier hs-var">MethodsAPI</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EmptyAPI</span></span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621679149679"><span class="annot"><span class="annottext">servantMethodHandlers :: (forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; Proxy svc
-&gt; HandlersT chn info inh '[] m '[]
-&gt; Server (MethodsAPI pkg svc '[] '[])
</span><a href="#local-6989586621679149679"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantMethodHandlers</span></a></span></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy pkg
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy svc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HandlersT chn info inh '[] m '[]
</span><span class="hs-identifier hs-var">H0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Server (MethodsAPI pkg svc '[] '[])
forall (m :: * -&gt; *). ServerT EmptyAPI m
</span><span class="hs-identifier hs-var">emptyServer</span></span></span></span></span></span></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span id="local-6989586621679149666"><span id="local-6989586621679149667"><span id="local-6989586621679149668"><span id="local-6989586621679149669"><span id="local-6989586621679149670"><span id="local-6989586621679149671"><span id="local-6989586621679149672"><span id="local-6989586621679149673"><span id="local-6989586621679149674"><span id="local-6989586621679149675"><span id="local-6989586621679149676"><span id="local-6989586621679149677"><span class="hs-keyword">instance</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandler"><span class="hs-identifier hs-type">ServantMethodHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149677"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149676"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149675"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149674"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149673"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149672"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandlers"><span class="hs-identifier hs-type">ServantMethodHandlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149671"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149670"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149675"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149669"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149668"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149667"><span class="hs-identifier hs-type">hs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#HttpMethodFor"><span class="hs-identifier hs-type">HttpMethodFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149671"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149670"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149666"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="#local-6989586621679149677"><span class="hs-identifier hs-type">httpMethod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#HttpStatusFor"><span class="hs-identifier hs-type">HttpStatusFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149671"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149670"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149666"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><a href="#local-6989586621679149676"><span class="hs-identifier hs-type">httpStatus</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#MethodAPI"><span class="hs-identifier hs-type">MethodAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149671"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149670"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679149666"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149674"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149673"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149672"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-type">HandlerAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149677"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149676"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149674"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149673"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149672"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandlers"><span class="hs-identifier hs-type">ServantMethodHandlers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149671"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149670"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149675"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149669"><span class="hs-identifier hs-type">chn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679149666"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149674"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149673"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149668"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149672"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149667"><span class="hs-identifier hs-type">hs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-215"></span><span>    </span><span id="MethodsAPI"><span class="annot"><a href="Mu.Servant.Server.html#MethodsAPI"><span class="hs-identifier hs-var">MethodsAPI</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149671"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149670"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679149666"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149674"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149673"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149668"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149672"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149667"><span class="hs-identifier hs-type">hs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>      </span><span class="annot"><a href="Mu.Servant.Server.html#MethodAPI"><span class="hs-identifier hs-type">MethodAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149671"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149670"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span class="annot"><a href="#local-6989586621679149666"><span class="hs-identifier hs-type">mname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149674"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149673"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149672"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-217"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">:&lt;|&gt;</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#MethodsAPI"><span class="hs-identifier hs-type">MethodsAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149671"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149670"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149668"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149667"><span class="hs-identifier hs-type">hs</span></a></span><span>
</span><span id="line-218"></span><span>  </span><span id="local-6989586621679149664"><span class="annot"><span class="annottext">servantMethodHandlers :: (forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; Proxy sname
-&gt; HandlersT chn info () ('Method mname args ret : rest) m (h : hs)
-&gt; Server
     (MethodsAPI pkg sname ('Method mname args ret : rest) (h : hs))
</span><a href="#local-6989586621679149664"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantMethodHandlers</span></a></span></span><span> </span><span id="local-6989586621679149663"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149663"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679149662"><span class="annot"><span class="annottext">Proxy pkg
</span><a href="#local-6989586621679149662"><span class="hs-identifier hs-var">pkgP</span></a></span></span><span> </span><span id="local-6989586621679149661"><span class="annot"><span class="annottext">Proxy sname
</span><a href="#local-6989586621679149661"><span class="hs-identifier hs-var">snameP</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hmore</span></span><span> </span><span class="annot"><span class="annottext">Proxy args
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy ret
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679149659"><span class="annot"><span class="annottext">RpcInfo info -&gt; () -&gt; h
</span><a href="#local-6989586621679149659"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679149658"><span class="annot"><span class="annottext">HandlersT chn info () ms m hs1
</span><a href="#local-6989586621679149658"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy args
-&gt; Proxy ret
-&gt; h
-&gt; Server (HandlerAPI httpMethod httpStatus args ret h)
forall snm anm (httpMethod :: StdMethod) (httpStatus :: Nat)
       (m :: * -&gt; *) (args :: [Argument snm anm (TypeRef snm)])
       (ret :: Return snm (TypeRef snm)) h.
ServantMethodHandler httpMethod httpStatus m args ret h =&gt;
(forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy args
-&gt; Proxy ret
-&gt; h
-&gt; Server (HandlerAPI httpMethod httpStatus args ret h)
</span><a href="Mu.Servant.Server.html#servantMethodHandler"><span class="hs-identifier hs-var">servantMethodHandler</span></a></span><span>
</span><span id="line-220"></span><span>      </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149663"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy httpMethod
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679149677"><span class="hs-identifier hs-type">httpMethod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy httpStatus
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679149676"><span class="hs-identifier hs-type">httpStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy args
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679149674"><span class="hs-identifier hs-type">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ret
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679149673"><span class="hs-identifier hs-type">ret</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RpcInfo info -&gt; () -&gt; h
</span><a href="#local-6989586621679149659"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">RpcInfo info
forall i. RpcInfo i
</span><span class="hs-identifier hs-var">NoRpcInfo</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>      </span><span class="annot"><span class="annottext">Server (HandlerAPI httpMethod httpStatus args ret h)
-&gt; ServerT (MethodsAPI pkg sname rest hs) Handler
-&gt; Server (HandlerAPI httpMethod httpStatus args ret h)
   :&lt;|&gt; ServerT (MethodsAPI pkg sname rest hs) Handler
forall a b. a -&gt; b -&gt; a :&lt;|&gt; b
</span><span class="hs-operator hs-var">:&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; Proxy sname
-&gt; HandlersT chn info () ms m hs1
-&gt; Server (MethodsAPI pkg sname ms hs1)
forall anm snm (pkg :: Package Symbol Symbol anm (TypeRef Symbol))
       (sname :: Symbol) (m :: * -&gt; *) (chn :: ServiceChain snm) inh
       (ms :: [Method snm Symbol anm (TypeRef snm)]) (hs :: [*]) info.
ServantMethodHandlers pkg sname m chn inh ms hs =&gt;
(forall a. m a -&gt; Handler a)
-&gt; Proxy pkg
-&gt; Proxy sname
-&gt; HandlersT chn info inh ms m hs
-&gt; Server (MethodsAPI pkg sname ms hs)
</span><a href="Mu.Servant.Server.html#servantMethodHandlers"><span class="hs-identifier hs-var">servantMethodHandlers</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149663"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy pkg
</span><a href="#local-6989586621679149662"><span class="hs-identifier hs-var">pkgP</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy sname
</span><a href="#local-6989586621679149661"><span class="hs-identifier hs-var">snameP</span></a></span><span> </span><span class="annot"><span class="annottext">HandlersT chn info () ms m hs1
</span><a href="#local-6989586621679149658"><span class="hs-identifier hs-var">rest</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="MethodAPI"><span class="annot"><a href="Mu.Servant.Server.html#MethodAPI"><span class="hs-identifier hs-var">MethodAPI</span></a></span></span><span> </span><span id="local-6989586621679149655"><span class="annot"><a href="#local-6989586621679149655"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679149654"><span class="annot"><a href="#local-6989586621679149654"><span class="hs-identifier hs-type">sname</span></a></span></span><span> </span><span id="local-6989586621679149653"><span class="annot"><a href="#local-6989586621679149653"><span class="hs-identifier hs-type">method</span></a></span></span><span> </span><span id="local-6989586621679149652"><span class="annot"><a href="#local-6989586621679149652"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-229"></span><span>  </span><span id="MethodAPI"><span class="annot"><a href="Mu.Servant.Server.html#MethodAPI"><span class="hs-identifier hs-var">MethodAPI</span></a></span></span><span> </span><span id="local-6989586621679149651"><span class="annot"><a href="#local-6989586621679149651"><span class="hs-identifier hs-type hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679149650"><span class="annot"><a href="#local-6989586621679149650"><span class="hs-identifier hs-type hs-type">sname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Method</span></span><span> </span><span id="local-6989586621679149649"><span class="annot"><a href="#local-6989586621679149649"><span class="hs-identifier hs-type hs-type">mname</span></a></span></span><span> </span><span id="local-6989586621679149648"><span class="annot"><a href="#local-6989586621679149648"><span class="hs-identifier hs-type hs-type">args</span></a></span></span><span> </span><span id="local-6989586621679149647"><span class="annot"><a href="#local-6989586621679149647"><span class="hs-identifier hs-type hs-type">ret</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679149646"><span class="annot"><a href="#local-6989586621679149646"><span class="hs-identifier hs-type hs-type">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#PrefixRoute"><span class="hs-identifier hs-type">PrefixRoute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#RouteFor"><span class="hs-identifier hs-type">RouteFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149651"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149650"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149649"><span class="hs-identifier hs-type">mname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-type">HandlerAPI</span></a></span><span>
</span><span id="line-232"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#HttpMethodFor"><span class="hs-identifier hs-type">HttpMethodFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149651"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149650"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149649"><span class="hs-identifier hs-type">mname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#HttpStatusFor"><span class="hs-identifier hs-type">HttpStatusFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149651"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149650"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149649"><span class="hs-identifier hs-type">mname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>          </span><span class="annot"><a href="#local-6989586621679149648"><span class="hs-identifier hs-type">args</span></a></span><span>
</span><span id="line-235"></span><span>          </span><span class="annot"><a href="#local-6989586621679149647"><span class="hs-identifier hs-type">ret</span></a></span><span>
</span><span id="line-236"></span><span>          </span><span class="annot"><a href="#local-6989586621679149646"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-keyword">class</span><span>
</span><span id="line-240"></span><span>  </span><span id="ServantMethodHandler"><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandler"><span class="hs-identifier hs-var">ServantMethodHandler</span></a></span></span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679149965"><span class="annot"><a href="#local-6989586621679149965"><span class="hs-identifier hs-type">httpMethod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdMethod</span></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679149964"><span class="annot"><a href="#local-6989586621679149964"><span class="hs-identifier hs-type">httpStatus</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679149963"><span class="annot"><a href="#local-6989586621679149963"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679149962"><span class="annot"><a href="#local-6989586621679149962"><span class="hs-identifier hs-type">args</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Argument</span></span><span> </span><span id="local-6989586621679149967"><span class="annot"><a href="#local-6989586621679149967"><span class="hs-identifier hs-type hs-type">snm</span></a></span></span><span> </span><span id="local-6989586621679149966"><span class="annot"><a href="#local-6989586621679149966"><span class="hs-identifier hs-type hs-type">anm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679149967"><span class="hs-identifier hs-type">snm</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679149961"><span class="annot"><a href="#local-6989586621679149961"><span class="hs-identifier hs-type">ret</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Return</span></span><span> </span><span class="annot"><a href="#local-6989586621679149967"><span class="hs-identifier hs-type">snm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span class="annot"><a href="#local-6989586621679149967"><span class="hs-identifier hs-type">snm</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679149960"><span class="annot"><a href="#local-6989586621679149960"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-248"></span><span>    </span><span id="HandlerAPI"><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-var">HandlerAPI</span></a></span></span><span>
</span><span id="line-249"></span><span>      </span><span id="local-6989586621679149965"><span class="annot"><a href="#local-6989586621679149965"><span class="hs-identifier hs-type">httpMethod</span></a></span></span><span>
</span><span id="line-250"></span><span>      </span><span id="local-6989586621679149964"><span class="annot"><a href="#local-6989586621679149964"><span class="hs-identifier hs-type">httpStatus</span></a></span></span><span>
</span><span id="line-251"></span><span>      </span><span id="local-6989586621679149962"><span class="annot"><a href="#local-6989586621679149962"><span class="hs-identifier hs-type">args</span></a></span></span><span>
</span><span id="line-252"></span><span>      </span><span id="local-6989586621679149961"><span class="annot"><a href="#local-6989586621679149961"><span class="hs-identifier hs-type">ret</span></a></span></span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621679149960"><span class="annot"><a href="#local-6989586621679149960"><span class="hs-identifier hs-type">h</span></a></span></span><span>
</span><span id="line-254"></span><span>  </span><span id="servantMethodHandler"><span class="annot"><a href="Mu.Servant.Server.html#servantMethodHandler"><span class="hs-identifier hs-type">servantMethodHandler</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679149959"><span class="annot"><a href="#local-6989586621679149959"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679149963"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149959"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679149959"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679149965"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679149964"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679149962"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679149961"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><a href="#local-6989586621679149960"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Servant.Server</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-type">HandlerAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149965"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149964"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149962"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149961"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149960"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span id="local-6989586621679149641"><span id="local-6989586621679149642"><span id="local-6989586621679149643"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandler"><span class="hs-identifier hs-type">ServantMethodHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149643"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149642"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">RetNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-265"></span><span>    </span><span id="HandlerAPI"><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-var">HandlerAPI</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149643"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149642"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">RetNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149641"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-comment">-- according to https://github.com/haskell-servant/servant/issues/683</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-comment">-- we always need a content type for NoContent</span><span>
</span><span id="line-268"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Verb</span></span><span> </span><span class="annot"><a href="#local-6989586621679149643"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149642"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">JSON</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoContent</span></span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621679149636"><span class="annot"><span class="annottext">servantMethodHandler :: (forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy '[]
-&gt; Proxy 'RetNothing
-&gt; m ()
-&gt; Server (HandlerAPI httpMethod httpStatus '[] 'RetNothing (m ()))
</span><a href="#local-6989586621679149636"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantMethodHandler</span></a></span></span><span> </span><span id="local-6989586621679149635"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149635"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy httpMethod
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy httpStatus
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy '[]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy 'RetNothing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() -&gt; NoContent) -&gt; Handler () -&gt; Handler NoContent
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NoContent -&gt; () -&gt; NoContent
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">NoContent
</span><span class="hs-identifier hs-var">NoContent</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; Handler NoContent)
-&gt; (m () -&gt; Handler ()) -&gt; m () -&gt; Handler NoContent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; Handler ()
forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149635"><span class="hs-identifier hs-var">f</span></a></span></span></span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span id="local-6989586621679149628"><span id="local-6989586621679149629"><span id="local-6989586621679149630"><span id="local-6989586621679149631"><span id="local-6989586621679149632"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandler"><span class="hs-identifier hs-type">ServantMethodHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149632"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149631"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149630"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">RetSingle</span></span><span> </span><span class="annot"><a href="#local-6989586621679149629"><span class="hs-identifier hs-type">rref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149630"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149628"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-273"></span><span>    </span><span id="HandlerAPI"><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-var">HandlerAPI</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149632"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149631"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">RetSingle</span></span><span> </span><span class="annot"><a href="#local-6989586621679149629"><span class="hs-identifier hs-type">rref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149630"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149628"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Verb</span></span><span> </span><span class="annot"><a href="#local-6989586621679149632"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149631"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#UnaryContentTypesFor"><span class="hs-identifier hs-type">UnaryContentTypesFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149629"><span class="hs-identifier hs-type">rref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149628"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span id="local-6989586621679149625"><span class="annot"><span class="annottext">servantMethodHandler :: (forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy '[]
-&gt; Proxy ('RetSingle rref)
-&gt; m r
-&gt; Server
     (HandlerAPI httpMethod httpStatus '[] ('RetSingle rref) (m r))
</span><a href="#local-6989586621679149625"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantMethodHandler</span></a></span></span><span> </span><span id="local-6989586621679149624"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149624"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy httpMethod
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy httpStatus
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy '[]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy ('RetSingle rref)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m r
-&gt; Server
     (HandlerAPI httpMethod httpStatus '[] ('RetSingle rref) (m r))
forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149624"><span class="hs-identifier hs-var">f</span></a></span></span></span></span></span></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span id="local-6989586621679149619"><span id="local-6989586621679149620"><span id="local-6989586621679149621"><span id="local-6989586621679149622"><span id="local-6989586621679149623"><span class="hs-keyword">instance</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679149623"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandler"><span class="hs-identifier hs-type">ServantMethodHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149622"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149621"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149623"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">RetStream</span></span><span> </span><span class="annot"><a href="#local-6989586621679149620"><span class="hs-identifier hs-type">rref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="annot"><a href="#local-6989586621679149619"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><a href="#local-6989586621679149623"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679149623"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-282"></span><span>    </span><span id="HandlerAPI"><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-var">HandlerAPI</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149622"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149621"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">RetStream</span></span><span> </span><span class="annot"><a href="#local-6989586621679149620"><span class="hs-identifier hs-type">rref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="annot"><a href="#local-6989586621679149619"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><a href="#local-6989586621679149623"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679149623"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-283"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Stream</span></span><span> </span><span class="annot"><a href="#local-6989586621679149622"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149621"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#StreamFramingFor"><span class="hs-identifier hs-type">StreamFramingFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149620"><span class="hs-identifier hs-type">rref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#StreamContentTypeFor"><span class="hs-identifier hs-type">StreamContentTypeFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149620"><span class="hs-identifier hs-type">rref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SourceIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#StreamResult"><span class="hs-identifier hs-type">StreamResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149619"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>  </span><span id="local-6989586621679149614"><span class="annot"><span class="annottext">servantMethodHandler :: (forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy '[]
-&gt; Proxy ('RetStream rref)
-&gt; (ConduitT r Void m () -&gt; m ())
-&gt; Server
     (HandlerAPI
        httpMethod
        httpStatus
        '[]
        ('RetStream rref)
        (ConduitT r Void m () -&gt; m ()))
</span><a href="#local-6989586621679149614"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantMethodHandler</span></a></span></span><span> </span><span id="local-6989586621679149613"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149613"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy httpMethod
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy httpStatus
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy '[]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Proxy ('RetStream rref)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (SourceIO (StreamResult r))
-&gt; Handler (SourceIO (StreamResult r))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (SourceIO (StreamResult r))
 -&gt; Handler (SourceIO (StreamResult r)))
-&gt; ((ConduitT r Void m () -&gt; m ())
    -&gt; IO (SourceIO (StreamResult r)))
-&gt; (ConduitT r Void m () -&gt; m ())
-&gt; Handler (SourceIO (StreamResult r))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Handler a)
-&gt; (ConduitT r Void m () -&gt; m ()) -&gt; IO (SourceIO (StreamResult r))
forall r (m :: * -&gt; *).
MonadServer m =&gt;
(forall a. m a -&gt; Handler a)
-&gt; (ConduitT r Void m () -&gt; m ()) -&gt; IO (SourceIO (StreamResult r))
</span><a href="Mu.Servant.Server.html#sinkToSource"><span class="hs-identifier hs-var">sinkToSource</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149613"><span class="hs-identifier hs-var">f</span></a></span></span></span></span></span></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- | represents a single element that will be streamed from the server to the client. That element will either be a `Result` containing a return value, or an `Error` indicating that something went wrong. Without this wrapper, server streams that encountered an error after the response headers have been sent would simply terminate without communicating to the client that anything went wrong.</span><span>
</span><span id="line-287"></span><span id="local-6989586621679149609"><span id="local-6989586621679149610"></span></span><span class="hs-keyword">data</span><span> </span><span id="StreamResult"><span class="annot"><a href="Mu.Servant.Server.html#StreamResult"><span class="hs-identifier hs-var">StreamResult</span></a></span></span><span> </span><span id="local-6989586621679149873"><span class="annot"><a href="#local-6989586621679149873"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Error"><span class="annot"><a href="Mu.Servant.Server.html#Error"><span class="hs-identifier hs-var">Error</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Result"><span class="annot"><a href="Mu.Servant.Server.html#Result"><span class="hs-identifier hs-var">Result</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149873"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. StreamResult a -&gt; Rep (StreamResult a) x)
-&gt; (forall x. Rep (StreamResult a) x -&gt; StreamResult a)
-&gt; Generic (StreamResult a)
forall x. Rep (StreamResult a) x -&gt; StreamResult a
forall x. StreamResult a -&gt; Rep (StreamResult a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a x. Rep (StreamResult a) x -&gt; StreamResult a
forall a x. StreamResult a -&gt; Rep (StreamResult a) x
$cto :: forall a x. Rep (StreamResult a) x -&gt; StreamResult a
$cfrom :: forall a x. StreamResult a -&gt; Rep (StreamResult a) x
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679149598"><span id="local-6989586621679149600"><span id="local-6989586621679149602"><span class="annot"><span class="annottext">Int -&gt; StreamResult a -&gt; ShowS
[StreamResult a] -&gt; ShowS
StreamResult a -&gt; String
(Int -&gt; StreamResult a -&gt; ShowS)
-&gt; (StreamResult a -&gt; String)
-&gt; ([StreamResult a] -&gt; ShowS)
-&gt; Show (StreamResult a)
forall a. Show a =&gt; Int -&gt; StreamResult a -&gt; ShowS
forall a. Show a =&gt; [StreamResult a] -&gt; ShowS
forall a. Show a =&gt; StreamResult a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [StreamResult a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [StreamResult a] -&gt; ShowS
show :: StreamResult a -&gt; String
$cshow :: forall a. Show a =&gt; StreamResult a -&gt; String
showsPrec :: Int -&gt; StreamResult a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; StreamResult a -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span id="local-6989586621679149596"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679149594"><span class="annot"><span class="hs-identifier hs-type">Data.Swagger.ToSchema</span></span><span> </span><span class="annot"><a href="#local-6989586621679149596"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Data.Swagger.ToSchema</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#StreamResult"><span class="hs-identifier hs-type">StreamResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149596"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-291"></span><span id="local-6989586621679149592"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679149585"><span id="local-6989586621679149587"><span id="local-6989586621679149589"><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621679149592"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#StreamResult"><span class="hs-identifier hs-type">StreamResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149592"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-292"></span><span>  </span><span id="local-6989586621679149583"><span class="annot"><span class="annottext">toJSON :: StreamResult a -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StreamResult a -&gt; Value
forall a.
(Generic a, GtoJson (Rep a), ConNames (Rep a), GIsEnum (Rep a)) =&gt;
a -&gt; Value
</span><span class="hs-identifier hs-var">gtoJson</span></span></span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="hs-comment">-- converts a conduit sink into a Servant SourceIO for interoperating with server streaming handlers</span><span>
</span><span id="line-295"></span><span class="annot"><a href="Mu.Servant.Server.html#sinkToSource"><span class="hs-identifier hs-type">sinkToSource</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679149919"><span class="annot"><a href="#local-6989586621679149919"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679149921"><span class="annot"><a href="#local-6989586621679149921"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679149921"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679149920"><span class="annot"><a href="#local-6989586621679149920"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621679149921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149920"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Handler</span></span><span> </span><span class="annot"><a href="#local-6989586621679149920"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="annot"><a href="#local-6989586621679149919"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><a href="#local-6989586621679149921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679149921"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SourceIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#StreamResult"><span class="hs-identifier hs-type">StreamResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149919"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span id="sinkToSource"><span class="annot"><span class="annottext">sinkToSource :: (forall a. m a -&gt; Handler a)
-&gt; (ConduitT r Void m () -&gt; m ()) -&gt; IO (SourceIO (StreamResult r))
</span><a href="Mu.Servant.Server.html#sinkToSource"><span class="hs-identifier hs-var hs-var">sinkToSource</span></a></span></span><span> </span><span id="local-6989586621679149580"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149580"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679149579"><span class="annot"><span class="annottext">ConduitT r Void m () -&gt; m ()
</span><a href="#local-6989586621679149579"><span class="hs-identifier hs-var">sink</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679149578"><span class="annot"><span class="annottext">MVar (Maybe r)
</span><a href="#local-6989586621679149578"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar (Maybe r))
forall a. IO (MVar a)
</span><span class="hs-identifier hs-var">newEmptyMVar</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679149919"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>  </span><span id="local-6989586621679149576"><span class="annot"><span class="annottext">Async (Either ServerError ())
</span><a href="#local-6989586621679149576"><span class="hs-identifier hs-var">forwarder</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Async (Either ServerError ()))
-&gt; IO (Async (Either ServerError ()))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Async (Either ServerError ()))
 -&gt; IO (Async (Either ServerError ())))
-&gt; IO (Async (Either ServerError ()))
-&gt; IO (Async (Either ServerError ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Either ServerError ()) -&gt; IO (Async (Either ServerError ()))
forall a. IO a -&gt; IO (Async a)
</span><span class="hs-identifier hs-var">async</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either ServerError ()) -&gt; IO (Async (Either ServerError ())))
-&gt; IO (Either ServerError ()) -&gt; IO (Async (Either ServerError ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679149574"><span class="annot"><span class="annottext">Either ServerError ()
</span><a href="#local-6989586621679149574"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handler () -&gt; IO (Either ServerError ())
forall a. Handler a -&gt; IO (Either ServerError a)
</span><span class="hs-identifier hs-var">runHandler</span></span><span> </span><span class="annot"><span class="annottext">(Handler () -&gt; IO (Either ServerError ()))
-&gt; (ConduitT r Void m () -&gt; Handler ())
-&gt; ConduitT r Void m ()
-&gt; IO (Either ServerError ())
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; Handler ()
forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149580"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; Handler ())
-&gt; (ConduitT r Void m () -&gt; m ())
-&gt; ConduitT r Void m ()
-&gt; Handler ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConduitT r Void m () -&gt; m ()
</span><a href="#local-6989586621679149579"><span class="hs-identifier hs-var">sink</span></a></span><span> </span><span class="annot"><span class="annottext">(ConduitT r Void m () -&gt; IO (Either ServerError ()))
-&gt; ConduitT r Void m () -&gt; IO (Either ServerError ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe r) -&gt; ConduitT r Void m ()
forall (m :: * -&gt; *) r.
MonadServer m =&gt;
MVar (Maybe r) -&gt; ConduitT r Void m ()
</span><a href="Mu.Servant.Server.html#toMVarConduit"><span class="hs-identifier hs-var">toMVarConduit</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe r)
</span><a href="#local-6989586621679149578"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-comment">-- signal that the conduit finished</span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">MVar (Maybe r) -&gt; Maybe r -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe r)
</span><a href="#local-6989586621679149578"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe r
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><span class="annottext">Either ServerError () -&gt; IO (Either ServerError ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Either ServerError ()
</span><a href="#local-6989586621679149574"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679149570"><span class="hs-identifier hs-type">step</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StepT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#StreamResult"><span class="hs-identifier hs-type">StreamResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149919"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>      </span><span id="local-6989586621679149570"><span class="annot"><span class="annottext">step :: StepT IO (StreamResult r)
</span><a href="#local-6989586621679149570"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (StepT IO (StreamResult r)) -&gt; StepT IO (StreamResult r)
forall (m :: * -&gt; *) a. m (StepT m a) -&gt; StepT m a
</span><span class="hs-identifier hs-var">Effect</span></span><span> </span><span class="annot"><span class="annottext">(IO (StepT IO (StreamResult r)) -&gt; StepT IO (StreamResult r))
-&gt; IO (StepT IO (StreamResult r)) -&gt; StepT IO (StreamResult r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-310"></span><span>        </span><span id="local-6989586621679149568"><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621679149568"><span class="hs-identifier hs-var">nextOutput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar (Maybe r) -&gt; IO (Maybe r)
forall a. MVar a -&gt; IO a
</span><span class="hs-identifier hs-var">takeMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe r)
</span><a href="#local-6989586621679149578"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621679149568"><span class="hs-identifier hs-var">nextOutput</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-312"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679149566"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679149566"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StepT IO (StreamResult r) -&gt; IO (StepT IO (StreamResult r))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StepT IO (StreamResult r) -&gt; IO (StepT IO (StreamResult r)))
-&gt; StepT IO (StreamResult r) -&gt; IO (StepT IO (StreamResult r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StreamResult r
-&gt; StepT IO (StreamResult r) -&gt; StepT IO (StreamResult r)
forall (m :: * -&gt; *) a. a -&gt; StepT m a -&gt; StepT m a
</span><span class="hs-identifier hs-var">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; StreamResult r
forall a. a -&gt; StreamResult a
</span><a href="Mu.Servant.Server.html#Result"><span class="hs-identifier hs-var">Result</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679149566"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StepT IO (StreamResult r)
</span><a href="#local-6989586621679149570"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-313"></span><span>          </span><span class="annot"><span class="annottext">Maybe r
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-314"></span><span>            </span><span class="hs-comment">-- waiting on this thread should get us sync and async exceptions</span><span>
</span><span id="line-315"></span><span>            </span><span id="local-6989586621679149564"><span class="annot"><span class="annottext">Either ServerError ()
</span><a href="#local-6989586621679149564"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Async (Either ServerError ()) -&gt; IO (Either ServerError ())
forall a. Async a -&gt; IO a
</span><span class="hs-identifier hs-var">wait</span></span><span> </span><span class="annot"><span class="annottext">Async (Either ServerError ())
</span><a href="#local-6989586621679149576"><span class="hs-identifier hs-var">forwarder</span></a></span><span>
</span><span id="line-316"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ServerError ()
</span><a href="#local-6989586621679149564"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-317"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679149562"><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679149562"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679149561"><span class="annot"><span class="annottext">streamErr :: String
</span><a href="#local-6989586621679149561"><span class="hs-identifier hs-var hs-var">streamErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><span class="hs-identifier hs-var">LB8.toString</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; String) -&gt; ByteString -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerError -&gt; ByteString
</span><span class="hs-identifier hs-var hs-var">errBody</span></span><span> </span><span class="annot"><span class="annottext">ServerError
</span><a href="#local-6989586621679149562"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-319"></span><span>                </span><span class="annot"><span class="annottext">StepT IO (StreamResult r) -&gt; IO (StepT IO (StreamResult r))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(StepT IO (StreamResult r) -&gt; IO (StepT IO (StreamResult r)))
-&gt; StepT IO (StreamResult r) -&gt; IO (StepT IO (StreamResult r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StreamResult r
-&gt; StepT IO (StreamResult r) -&gt; StepT IO (StreamResult r)
forall (m :: * -&gt; *) a. a -&gt; StepT m a -&gt; StepT m a
</span><span class="hs-identifier hs-var">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; StreamResult r
forall a. String -&gt; StreamResult a
</span><a href="Mu.Servant.Server.html#Error"><span class="hs-identifier hs-var">Mu.Servant.Server.Error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149561"><span class="hs-identifier hs-var">streamErr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StepT IO (StreamResult r)
forall (m :: * -&gt; *) a. StepT m a
</span><span class="hs-identifier hs-var">Stop</span></span><span>
</span><span id="line-320"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StepT IO (StreamResult r) -&gt; IO (StepT IO (StreamResult r))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">StepT IO (StreamResult r)
forall (m :: * -&gt; *) a. StepT m a
</span><span class="hs-identifier hs-var">Stop</span></span><span>
</span><span id="line-321"></span><span>  </span><span class="annot"><span class="annottext">SourceIO (StreamResult r) -&gt; IO (SourceIO (StreamResult r))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SourceIO (StreamResult r) -&gt; IO (SourceIO (StreamResult r)))
-&gt; SourceIO (StreamResult r) -&gt; IO (SourceIO (StreamResult r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StepT IO (StreamResult r) -&gt; SourceIO (StreamResult r)
forall (m :: * -&gt; *) a. StepT m a -&gt; SourceT m a
</span><span class="hs-identifier hs-var">fromStepT</span></span><span> </span><span class="annot"><span class="annottext">StepT IO (StreamResult r)
</span><a href="#local-6989586621679149570"><span class="hs-identifier hs-var">step</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span id="local-6989586621679149882"><span id="local-6989586621679149883"><span class="annot"><a href="Mu.Servant.Server.html#toMVarConduit"><span class="hs-identifier hs-type">toMVarConduit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679149883"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679149882"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="annot"><a href="#local-6989586621679149882"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span> </span><span class="annot"><a href="#local-6989586621679149883"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-324"></span><span id="toMVarConduit"><span class="annot"><span class="annottext">toMVarConduit :: MVar (Maybe r) -&gt; ConduitT r Void m ()
</span><a href="Mu.Servant.Server.html#toMVarConduit"><span class="hs-identifier hs-var hs-var">toMVarConduit</span></a></span></span><span> </span><span id="local-6989586621679149557"><span class="annot"><span class="annottext">MVar (Maybe r)
</span><a href="#local-6989586621679149557"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>  </span><span id="local-6989586621679149556"><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621679149556"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConduitT r Void m (Maybe r)
forall (m :: * -&gt; *) i. Monad m =&gt; Consumer i m (Maybe i)
</span><span class="hs-identifier hs-var">await</span></span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621679149556"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><span class="annottext">Maybe r
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ConduitT r Void m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-329"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; ConduitT r Void m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ConduitT r Void m ()) -&gt; IO () -&gt; ConduitT r Void m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe r) -&gt; Maybe r -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">putMVar</span></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe r)
</span><a href="#local-6989586621679149557"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621679149556"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-330"></span><span>      </span><span class="annot"><span class="annottext">MVar (Maybe r) -&gt; ConduitT r Void m ()
forall (m :: * -&gt; *) r.
MonadServer m =&gt;
MVar (Maybe r) -&gt; ConduitT r Void m ()
</span><a href="Mu.Servant.Server.html#toMVarConduit"><span class="hs-identifier hs-var">toMVarConduit</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (Maybe r)
</span><a href="#local-6989586621679149557"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span id="local-6989586621679149546"><span id="local-6989586621679149547"><span id="local-6989586621679149548"><span id="local-6989586621679149549"><span id="local-6989586621679149550"><span id="local-6989586621679149551"><span id="local-6989586621679149552"><span id="local-6989586621679149553"><span id="local-6989586621679149554"><span class="hs-keyword">instance</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandler"><span class="hs-identifier hs-type">ServantMethodHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149554"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149553"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149551"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149550"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149549"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandler"><span class="hs-identifier hs-type">ServantMethodHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149554"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149553"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ArgSingle</span></span><span> </span><span class="annot"><a href="#local-6989586621679149548"><span class="hs-identifier hs-type">anm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149547"><span class="hs-identifier hs-type">aref</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149551"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149550"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149546"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679149549"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-337"></span><span>    </span><span id="HandlerAPI"><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-var">HandlerAPI</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149554"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149553"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ArgSingle</span></span><span> </span><span class="annot"><a href="#local-6989586621679149548"><span class="hs-identifier hs-type">anm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149547"><span class="hs-identifier hs-type">aref</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149551"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149550"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679149546"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679149549"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-338"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">ReqBody</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#UnaryContentTypesFor"><span class="hs-identifier hs-type">UnaryContentTypesFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149547"><span class="hs-identifier hs-type">aref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149546"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-type">HandlerAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149554"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149553"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149551"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149550"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149549"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-339"></span><span>  </span><span id="local-6989586621679149542"><span class="annot"><span class="annottext">servantMethodHandler :: (forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy ('ArgSingle anm aref : rest)
-&gt; Proxy ret
-&gt; (t -&gt; h)
-&gt; Server
     (HandlerAPI
        httpMethod httpStatus ('ArgSingle anm aref : rest) ret (t -&gt; h))
</span><a href="#local-6989586621679149542"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantMethodHandler</span></a></span></span><span> </span><span id="local-6989586621679149541"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149541"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679149540"><span class="annot"><span class="annottext">Proxy httpMethod
</span><a href="#local-6989586621679149540"><span class="hs-identifier hs-var">mP</span></a></span></span><span> </span><span id="local-6989586621679149539"><span class="annot"><span class="annottext">Proxy httpStatus
</span><a href="#local-6989586621679149539"><span class="hs-identifier hs-var">sP</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy ('ArgSingle anm aref : rest)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679149538"><span class="annot"><span class="annottext">Proxy ret
</span><a href="#local-6989586621679149538"><span class="hs-identifier hs-var">retP</span></a></span></span><span> </span><span id="local-6989586621679149537"><span class="annot"><span class="annottext">t -&gt; h
</span><a href="#local-6989586621679149537"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679149536"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679149536"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy rest
-&gt; Proxy ret
-&gt; h
-&gt; Server (HandlerAPI httpMethod httpStatus rest ret h)
forall snm anm (httpMethod :: StdMethod) (httpStatus :: Nat)
       (m :: * -&gt; *) (args :: [Argument snm anm (TypeRef snm)])
       (ret :: Return snm (TypeRef snm)) h.
ServantMethodHandler httpMethod httpStatus m args ret h =&gt;
(forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy args
-&gt; Proxy ret
-&gt; h
-&gt; Server (HandlerAPI httpMethod httpStatus args ret h)
</span><a href="Mu.Servant.Server.html#servantMethodHandler"><span class="hs-identifier hs-var">servantMethodHandler</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149541"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy httpMethod
</span><a href="#local-6989586621679149540"><span class="hs-identifier hs-var">mP</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy httpStatus
</span><a href="#local-6989586621679149539"><span class="hs-identifier hs-var">sP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy rest
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679149551"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proxy ret
</span><a href="#local-6989586621679149538"><span class="hs-identifier hs-var">retP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; h
</span><a href="#local-6989586621679149537"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679149536"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span id="local-6989586621679149527"><span id="local-6989586621679149528"><span id="local-6989586621679149529"><span id="local-6989586621679149530"><span id="local-6989586621679149531"><span id="local-6989586621679149532"><span id="local-6989586621679149533"><span id="local-6989586621679149534"><span id="local-6989586621679149535"><span class="hs-keyword">instance</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679149535"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandler"><span class="hs-identifier hs-type">ServantMethodHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149534"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149533"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149535"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149532"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149531"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149530"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#ServantMethodHandler"><span class="hs-identifier hs-type">ServantMethodHandler</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149534"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149533"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149535"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ArgStream</span></span><span> </span><span class="annot"><a href="#local-6989586621679149529"><span class="hs-identifier hs-type">anm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149528"><span class="hs-identifier hs-type">aref</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149532"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149531"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149527"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149535"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679149530"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-347"></span><span>    </span><span id="HandlerAPI"><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-var">HandlerAPI</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679149534"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149533"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ArgStream</span></span><span> </span><span class="annot"><a href="#local-6989586621679149529"><span class="hs-identifier hs-type">anm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149528"><span class="hs-identifier hs-type">aref</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621679149532"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149531"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149527"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149535"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679149530"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">StreamBody</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#StreamFramingFor"><span class="hs-identifier hs-type">StreamFramingFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149528"><span class="hs-identifier hs-type">aref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#StreamContentTypeFor"><span class="hs-identifier hs-type">StreamContentTypeFor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149528"><span class="hs-identifier hs-type">aref</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SourceIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679149527"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#HandlerAPI"><span class="hs-identifier hs-type">HandlerAPI</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149534"><span class="hs-identifier hs-type">httpMethod</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149533"><span class="hs-identifier hs-type">httpStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149532"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149531"><span class="hs-identifier hs-type">ret</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149530"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-350"></span><span>  </span><span id="local-6989586621679149524"><span class="annot"><span class="annottext">servantMethodHandler :: (forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy ('ArgStream anm aref : rest)
-&gt; Proxy ret
-&gt; (ConduitT () t m () -&gt; h)
-&gt; Server
     (HandlerAPI
        httpMethod
        httpStatus
        ('ArgStream anm aref : rest)
        ret
        (ConduitT () t m () -&gt; h))
</span><a href="#local-6989586621679149524"><span class="hs-identifier hs-var hs-var hs-var hs-var">servantMethodHandler</span></a></span></span><span> </span><span id="local-6989586621679149523"><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149523"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679149522"><span class="annot"><span class="annottext">Proxy httpMethod
</span><a href="#local-6989586621679149522"><span class="hs-identifier hs-var">mP</span></a></span></span><span> </span><span id="local-6989586621679149521"><span class="annot"><span class="annottext">Proxy httpStatus
</span><a href="#local-6989586621679149521"><span class="hs-identifier hs-var">sP</span></a></span></span><span> </span><span class="annot"><span class="annottext">Proxy ('ArgStream anm aref : rest)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679149520"><span class="annot"><span class="annottext">Proxy ret
</span><a href="#local-6989586621679149520"><span class="hs-identifier hs-var">retP</span></a></span></span><span> </span><span id="local-6989586621679149519"><span class="annot"><span class="annottext">ConduitT () t m () -&gt; h
</span><a href="#local-6989586621679149519"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><span class="annottext">(forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy rest
-&gt; Proxy ret
-&gt; h
-&gt; Server (HandlerAPI httpMethod httpStatus rest ret h)
forall snm anm (httpMethod :: StdMethod) (httpStatus :: Nat)
       (m :: * -&gt; *) (args :: [Argument snm anm (TypeRef snm)])
       (ret :: Return snm (TypeRef snm)) h.
ServantMethodHandler httpMethod httpStatus m args ret h =&gt;
(forall a. m a -&gt; Handler a)
-&gt; Proxy httpMethod
-&gt; Proxy httpStatus
-&gt; Proxy args
-&gt; Proxy ret
-&gt; h
-&gt; Server (HandlerAPI httpMethod httpStatus args ret h)
</span><a href="Mu.Servant.Server.html#servantMethodHandler"><span class="hs-identifier hs-var">servantMethodHandler</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. m a -&gt; Handler a
</span><a href="#local-6989586621679149523"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy httpMethod
</span><a href="#local-6989586621679149522"><span class="hs-identifier hs-var">mP</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy httpStatus
</span><a href="#local-6989586621679149521"><span class="hs-identifier hs-var">sP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy rest
forall k (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679149532"><span class="hs-identifier hs-type">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proxy ret
</span><a href="#local-6989586621679149520"><span class="hs-identifier hs-var">retP</span></a></span><span> </span><span class="annot"><span class="annottext">(h -&gt; Server (HandlerAPI httpMethod httpStatus rest ret h))
-&gt; (SourceIO t -&gt; h)
-&gt; SourceIO t
-&gt; Server (HandlerAPI httpMethod httpStatus rest ret h)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ConduitT () t m () -&gt; h
</span><a href="#local-6989586621679149519"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">(ConduitT () t m () -&gt; h)
-&gt; (SourceIO t -&gt; ConduitT () t m ()) -&gt; SourceIO t -&gt; h
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SourceIO t -&gt; ConduitT () t m ()
forall (m :: * -&gt; *) t.
MonadServer m =&gt;
SourceIO t -&gt; ConduitT () t m ()
</span><a href="Mu.Servant.Server.html#sourceToSource"><span class="hs-identifier hs-var">sourceToSource</span></a></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-comment">-- converts a Servant SourceIO into a conduit for interoperating with client streaming handlers</span><span>
</span><span id="line-354"></span><span id="local-6989586621679149838"><span id="local-6989586621679149839"><span class="annot"><a href="Mu.Servant.Server.html#sourceToSource"><span class="hs-identifier hs-type">sourceToSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679149839"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SourceIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679149838"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ConduitT</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149838"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149839"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-355"></span><span id="sourceToSource"><span class="annot"><span class="annottext">sourceToSource :: SourceIO t -&gt; ConduitT () t m ()
</span><a href="Mu.Servant.Server.html#sourceToSource"><span class="hs-identifier hs-var hs-var">sourceToSource</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SourceT</span></span><span> </span><span id="local-6989586621679149516"><span class="annot"><span class="annottext">forall b. (StepT IO t -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621679149516"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall b. (() -&gt; Pipe () () t () m b) -&gt; Pipe () () t () m b)
-&gt; ConduitT () t m ()
forall i o (m :: * -&gt; *) r.
(forall b. (r -&gt; Pipe i i o () m b) -&gt; Pipe i i o () m b)
-&gt; ConduitT i o m r
</span><span class="hs-identifier hs-var">ConduitT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Pipe () () t () m ()) -&gt; Pipe () () t () m ()
forall l i o u (m :: * -&gt; *) r.
m (Pipe l i o u m r) -&gt; Pipe l i o u m r
</span><span class="hs-identifier hs-var">PipeM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Pipe () () t () m ()) -&gt; m (Pipe () () t () m ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Pipe () () t () m ()) -&gt; m (Pipe () () t () m ()))
-&gt; IO (Pipe () () t () m ()) -&gt; m (Pipe () () t () m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(StepT IO t -&gt; IO (Pipe () () t () m ()))
-&gt; IO (Pipe () () t () m ())
forall b. (StepT IO t -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621679149516"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pipe () () t () m () -&gt; IO (Pipe () () t () m ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Pipe () () t () m () -&gt; IO (Pipe () () t () m ()))
-&gt; (StepT IO t -&gt; Pipe () () t () m ())
-&gt; StepT IO t
-&gt; IO (Pipe () () t () m ())
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StepT IO t -&gt; Pipe () () t () m ()
forall (m :: * -&gt; *) t i u.
MonadServer m =&gt;
StepT IO t -&gt; Pipe i i t u m ()
</span><a href="#local-6989586621679149513"><span class="hs-identifier hs-var">go</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pipe () () t () m ()
-&gt; (() -&gt; Pipe () () t () m b) -&gt; Pipe () () t () m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621679149819"><span id="local-6989586621679149820"><span id="local-6989586621679149821"><span id="local-6989586621679149822"><span class="annot"><a href="#local-6989586621679149513"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadServer</span></span><span> </span><span class="annot"><a href="#local-6989586621679149822"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StepT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679149821"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pipe</span></span><span> </span><span class="annot"><a href="#local-6989586621679149820"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149820"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149821"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149819"><span class="hs-identifier hs-type">u</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149822"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621679149513"><span class="annot"><span class="annottext">go :: StepT IO t -&gt; Pipe i i t u m ()
</span><a href="#local-6989586621679149513"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">StepT IO t
</span><span class="hs-identifier hs-var">Stop</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Pipe i i t u m ()
forall l i o u (m :: * -&gt; *) r. r -&gt; Pipe l i o u m r
</span><span class="hs-identifier hs-var">Done</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><a href="#local-6989586621679149513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Skip</span></span><span> </span><span id="local-6989586621679149510"><span class="annot"><span class="annottext">StepT IO t
</span><a href="#local-6989586621679149510"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StepT IO t -&gt; Pipe i i t u m ()
forall (m :: * -&gt; *) t i u.
MonadServer m =&gt;
StepT IO t -&gt; Pipe i i t u m ()
</span><a href="#local-6989586621679149513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">StepT IO t
</span><a href="#local-6989586621679149510"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><a href="#local-6989586621679149513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Yield</span></span><span> </span><span id="local-6989586621679149509"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679149509"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679149508"><span class="annot"><span class="annottext">StepT IO t
</span><a href="#local-6989586621679149508"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pipe i i t u m () -&gt; t -&gt; Pipe i i t u m ()
forall l i o u (m :: * -&gt; *) r.
Pipe l i o u m r -&gt; o -&gt; Pipe l i o u m r
</span><span class="hs-identifier hs-var">HaveOutput</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StepT IO t -&gt; Pipe i i t u m ()
forall (m :: * -&gt; *) t i u.
MonadServer m =&gt;
StepT IO t -&gt; Pipe i i t u m ()
</span><a href="#local-6989586621679149513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">StepT IO t
</span><a href="#local-6989586621679149508"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679149509"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><a href="#local-6989586621679149513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Effect</span></span><span> </span><span id="local-6989586621679149506"><span class="annot"><span class="annottext">IO (StepT IO t)
</span><a href="#local-6989586621679149506"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (Pipe i i t u m ()) -&gt; Pipe i i t u m ()
forall l i o u (m :: * -&gt; *) r.
m (Pipe l i o u m r) -&gt; Pipe l i o u m r
</span><span class="hs-identifier hs-var">PipeM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Pipe i i t u m ()) -&gt; m (Pipe i i t u m ())
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Pipe i i t u m ()) -&gt; m (Pipe i i t u m ()))
-&gt; IO (Pipe i i t u m ()) -&gt; m (Pipe i i t u m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StepT IO t -&gt; Pipe i i t u m ()
forall (m :: * -&gt; *) t i u.
MonadServer m =&gt;
StepT IO t -&gt; Pipe i i t u m ()
</span><a href="#local-6989586621679149513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(StepT IO t -&gt; Pipe i i t u m ())
-&gt; IO (StepT IO t) -&gt; IO (Pipe i i t u m ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (StepT IO t)
</span><a href="#local-6989586621679149506"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><a href="#local-6989586621679149513"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Servant.Types.SourceT.Error</span></span><span> </span><span id="local-6989586621679149503"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149503"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-363"></span><span>      </span><span class="annot"><span class="annottext">m (Pipe i i t u m ()) -&gt; Pipe i i t u m ()
forall l i o u (m :: * -&gt; *) r.
m (Pipe l i o u m r) -&gt; Pipe l i o u m r
</span><span class="hs-identifier hs-var">PipeM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ServerError -&gt; m (Pipe i i t u m ())
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ServerError -&gt; m (Pipe i i t u m ()))
-&gt; ServerError -&gt; m (Pipe i i t u m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ServerErrorCode -&gt; String -&gt; ServerError
</span><span class="hs-identifier hs-var">Mu.Server.ServerError</span></span><span> </span><span class="annot"><span class="annottext">ServerErrorCode
</span><span class="hs-identifier hs-var">Invalid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;error reading stream: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679149503"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span class="hs-comment">-- | ServantRoute represents the URL path components of a route. It is used as an `AnnotatedPackage` domain to override the default path for a `Method`. When used in an `AnnService`, the specified `TopLevelRoute` is used as a prefix for all `Method`s in that `Service`.</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- 1. List of components for the route,</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- 2. HTTP method which must be used,</span><span>
</span><span id="line-368"></span><span class="hs-comment">-- 3. HTTP status code of a successful HTTP response from a specific `Method`. Use 200 for the usual status code.</span><span>
</span><span id="line-369"></span><span class="hs-keyword">data</span><span> </span><span id="ServantRoute"><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-var">ServantRoute</span></a></span></span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ServantAdditional"><span class="annot"><a href="Mu.Servant.Server.html#ServantAdditional"><span class="hs-identifier hs-var">ServantAdditional</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ServantTopLevelRoute"><span class="annot"><a href="Mu.Servant.Server.html#ServantTopLevelRoute"><span class="hs-identifier hs-var">ServantTopLevelRoute</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">]</span><span>
</span><span id="line-372"></span><span>  </span><span class="hs-glyph">|</span><span>&#160;</span><span id="ServantRoute"><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-var">ServantRoute</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdMethod</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Assert"><span class="annot"><a href="Mu.Servant.Server.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149498"><span class="annot"><a href="#local-6989586621679149498"><span class="hs-identifier hs-type">err</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149497"><span class="annot"><a href="#local-6989586621679149497"><span class="hs-identifier hs-type">break</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679149496"><span class="annot"><a href="#local-6989586621679149496"><span class="hs-identifier hs-type hs-type">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149495"><span class="annot"><a href="#local-6989586621679149495"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679149494"><span class="annot"><a href="#local-6989586621679149494"><span class="hs-identifier hs-type hs-type">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679149494"><span class="hs-identifier hs-type">k2</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-comment">-- these cases exist to force evaluation of the &quot;break&quot; parameter when it either has kind [RpcAnnotation ...] or [Annotation ...]</span><span>
</span><span id="line-376"></span><span>  </span><span id="Assert"><span class="annot"><a href="Mu.Servant.Server.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">AnnSchema</span></span><span> </span><span id="local-6989586621679149492"><span class="annot"><a href="#local-6989586621679149492"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">AnnSchema</span></span><span> </span><span class="annot"><a href="#local-6989586621679149492"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span>
</span><span id="line-377"></span><span>  </span><span id="Assert"><span class="annot"><a href="Mu.Servant.Server.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">AnnPackage</span></span><span> </span><span id="local-6989586621679149490"><span class="annot"><a href="#local-6989586621679149490"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">AnnPackage</span></span><span> </span><span class="annot"><a href="#local-6989586621679149490"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-comment">-- this case should be used whenever &quot;break&quot; is not stuck</span><span>
</span><span id="line-379"></span><span>  </span><span id="Assert"><span class="annot"><a href="Mu.Servant.Server.html#Assert"><span class="hs-identifier hs-var">Assert</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679149489"><span class="annot"><a href="#local-6989586621679149489"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149489"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-380"></span><span>
</span><span id="line-381"></span><span class="hs-comment">-- a helper type synonym used to provide better errors when a required AnnotatedPackage instance doesn't exist</span><span>
</span><span id="line-382"></span><span class="hs-keyword">type</span><span> </span><span id="WithAnnotatedPackageInstance"><span class="annot"><a href="Mu.Servant.Server.html#WithAnnotatedPackageInstance"><span class="hs-identifier hs-var">WithAnnotatedPackageInstance</span></a></span></span><span> </span><span id="local-6989586621679149488"><span class="annot"><a href="#local-6989586621679149488"><span class="hs-identifier hs-type">domain</span></a></span></span><span> </span><span id="local-6989586621679149487"><span class="annot"><a href="#local-6989586621679149487"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679149486"><span class="annot"><a href="#local-6989586621679149486"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#NoPackageAnnotations"><span class="hs-identifier hs-type">NoPackageAnnotations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149488"><span class="hs-identifier hs-type">domain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149487"><span class="hs-identifier hs-type">pkg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedPackage</span></span><span> </span><span class="annot"><a href="#local-6989586621679149488"><span class="hs-identifier hs-type">domain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149487"><span class="hs-identifier hs-type">pkg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149486"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- a helper type synonym used to provide better errors when a required AnnotatedSchema instance doesn't exist</span><span>
</span><span id="line-386"></span><span class="hs-keyword">type</span><span> </span><span id="WithAnnotatedSchemaInstance"><span class="annot"><a href="Mu.Servant.Server.html#WithAnnotatedSchemaInstance"><span class="hs-identifier hs-var">WithAnnotatedSchemaInstance</span></a></span></span><span> </span><span id="local-6989586621679149483"><span class="annot"><a href="#local-6989586621679149483"><span class="hs-identifier hs-type">domain</span></a></span></span><span> </span><span id="local-6989586621679149482"><span class="annot"><a href="#local-6989586621679149482"><span class="hs-identifier hs-type">sch</span></a></span></span><span> </span><span id="local-6989586621679149481"><span class="annot"><a href="#local-6989586621679149481"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><a href="Mu.Servant.Server.html#Assert"><span class="hs-identifier hs-type">Assert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#NoSchemaAnnotations"><span class="hs-identifier hs-type">NoSchemaAnnotations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149483"><span class="hs-identifier hs-type">domain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149482"><span class="hs-identifier hs-type">sch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedSchema</span></span><span> </span><span class="annot"><a href="#local-6989586621679149483"><span class="hs-identifier hs-type">domain</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149482"><span class="hs-identifier hs-type">sch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149481"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-comment">-- a helper type family for generating custom error messages about missing AnnotatedPackage instances</span><span>
</span><span id="line-391"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="NoPackageAnnotations"><span class="annot"><a href="Mu.Servant.Server.html#NoPackageAnnotations"><span class="hs-identifier hs-var">NoPackageAnnotations</span></a></span></span><span> </span><span id="local-6989586621679149478"><span class="annot"><a href="#local-6989586621679149478"><span class="hs-identifier hs-type">domain</span></a></span></span><span> </span><span id="local-6989586621679149477"><span class="annot"><a href="#local-6989586621679149477"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-392"></span><span>  </span><span id="NoPackageAnnotations"><span class="annot"><a href="Mu.Servant.Server.html#NoPackageAnnotations"><span class="hs-identifier hs-var">NoPackageAnnotations</span></a></span></span><span> </span><span id="local-6989586621679149476"><span class="annot"><a href="#local-6989586621679149476"><span class="hs-identifier hs-type hs-type">domain</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679149475"><span class="annot"><a href="#local-6989586621679149475"><span class="hs-identifier hs-type hs-type">pname</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-394"></span><span>        </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Missing required AnnotatedPackage &quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ShowType</span></span><span> </span><span class="annot"><a href="#local-6989586621679149476"><span class="hs-identifier hs-type">domain</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot; type instance&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span>
</span><span id="line-395"></span><span>        </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;for &quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ShowType</span></span><span> </span><span class="annot"><a href="#local-6989586621679149475"><span class="hs-identifier hs-type">pname</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot; package&quot;</span></span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>  </span><span id="NoPackageAnnotations"><span class="annot"><a href="Mu.Servant.Server.html#NoPackageAnnotations"><span class="hs-identifier hs-var">NoPackageAnnotations</span></a></span></span><span> </span><span id="local-6989586621679149474"><span class="annot"><a href="#local-6989586621679149474"><span class="hs-identifier hs-type hs-type">domain</span></a></span></span><span> </span><span id="local-6989586621679149473"><span class="annot"><a href="#local-6989586621679149473"><span class="hs-identifier hs-type hs-type">pkg</span></a></span></span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Missing required AnnotatedPackage &quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ShowType</span></span><span> </span><span class="annot"><a href="#local-6989586621679149474"><span class="hs-identifier hs-type">domain</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot; type instance&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;for unnamed package: &quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ShowType</span></span><span> </span><span class="annot"><a href="#local-6989586621679149473"><span class="hs-identifier hs-type">pkg</span></a></span><span>
</span><span id="line-401"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span class="hs-comment">-- a helper type family for generating custom error messages about missing AnnotatedSchema instances</span><span>
</span><span id="line-404"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="NoSchemaAnnotations"><span class="annot"><a href="Mu.Servant.Server.html#NoSchemaAnnotations"><span class="hs-identifier hs-var">NoSchemaAnnotations</span></a></span></span><span> </span><span id="local-6989586621679149472"><span class="annot"><a href="#local-6989586621679149472"><span class="hs-identifier hs-type">domain</span></a></span></span><span> </span><span id="local-6989586621679149471"><span class="annot"><a href="#local-6989586621679149471"><span class="hs-identifier hs-type">sch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-405"></span><span>  </span><span id="NoSchemaAnnotations"><span class="annot"><a href="Mu.Servant.Server.html#NoSchemaAnnotations"><span class="hs-identifier hs-var">NoSchemaAnnotations</span></a></span></span><span> </span><span id="local-6989586621679149470"><span class="annot"><a href="#local-6989586621679149470"><span class="hs-identifier hs-type hs-type">domain</span></a></span></span><span> </span><span id="local-6989586621679149469"><span class="annot"><a href="#local-6989586621679149469"><span class="hs-identifier hs-type hs-type">sch</span></a></span></span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Missing required AnnotatedSchema &quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ShowType</span></span><span> </span><span class="annot"><a href="#local-6989586621679149470"><span class="hs-identifier hs-type">domain</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot; type instance&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span>
</span><span id="line-408"></span><span>        </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;for schema:&quot;</span></span><span> </span><span class="hs-special">'</span><span class="hs-operator">:$$:</span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">ShowType</span></span><span> </span><span class="annot"><a href="#local-6989586621679149469"><span class="hs-identifier hs-type">sch</span></a></span><span>
</span><span id="line-409"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-comment">-- used to construct a route for a specific method m of service s in package pkg from the @AnnotatedPackage ServantRoute pkg@ instance, along with a custom error message</span><span>
</span><span id="line-412"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="RouteFor"><span class="annot"><a href="Mu.Servant.Server.html#RouteFor"><span class="hs-identifier hs-var">RouteFor</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149468"><span class="annot"><a href="#local-6989586621679149468"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span id="local-6989586621679149467"><span class="annot"><a href="#local-6989586621679149467"><span class="hs-identifier hs-type hs-type">snm</span></a></span></span><span> </span><span id="local-6989586621679149466"><span class="annot"><a href="#local-6989586621679149466"><span class="hs-identifier hs-type hs-type">mnm</span></a></span></span><span> </span><span id="local-6989586621679149465"><span class="annot"><a href="#local-6989586621679149465"><span class="hs-identifier hs-type hs-type">anm</span></a></span></span><span> </span><span id="local-6989586621679149464"><span class="annot"><a href="#local-6989586621679149464"><span class="hs-identifier hs-type hs-type">tyref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149463"><span class="annot"><a href="#local-6989586621679149463"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149462"><span class="annot"><a href="#local-6989586621679149462"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-413"></span><span>  </span><span id="RouteFor"><span class="annot"><a href="Mu.Servant.Server.html#RouteFor"><span class="hs-identifier hs-var">RouteFor</span></a></span></span><span> </span><span id="local-6989586621679149461"><span class="annot"><a href="#local-6989586621679149461"><span class="hs-identifier hs-type hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679149460"><span class="annot"><a href="#local-6989586621679149460"><span class="hs-identifier hs-type hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679149459"><span class="annot"><a href="#local-6989586621679149459"><span class="hs-identifier hs-type hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-414"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#WithAnnotatedPackageInstance"><span class="hs-identifier hs-type">WithAnnotatedPackageInstance</span></a></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149461"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-415"></span><span>      </span><span class="annot"><a href="Mu.Servant.Server.html#Concat"><span class="hs-identifier hs-type">Concat</span></a></span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantRoute"><span class="hs-identifier hs-type">UnwrapServantRoute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#FromMaybe"><span class="hs-identifier hs-type">FromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679149460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetServiceAnnotationMay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedPackage</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149461"><span class="hs-identifier hs-type">pkg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149460"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantRoute"><span class="hs-identifier hs-type">UnwrapServantRoute</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#FromMaybe"><span class="hs-identifier hs-type">FromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679149459"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetMethodAnnotationMay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedPackage</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149461"><span class="hs-identifier hs-type">pkg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149460"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149459"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="UnwrapServantRoute"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantRoute"><span class="hs-identifier hs-var">UnwrapServantRoute</span></a></span></span><span> </span><span id="local-6989586621679149454"><span class="annot"><a href="#local-6989586621679149454"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-421"></span><span>  </span><span id="UnwrapServantRoute"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantRoute"><span class="hs-identifier hs-var">UnwrapServantRoute</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantTopLevelRoute"><span class="hs-identifier hs-type">ServantTopLevelRoute</span></a></span><span> </span><span id="local-6989586621679149453"><span class="annot"><a href="#local-6989586621679149453"><span class="hs-identifier hs-type hs-type">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149453"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span id="UnwrapServantRoute"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantRoute"><span class="hs-identifier hs-var">UnwrapServantRoute</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span id="local-6989586621679149452"><span class="annot"><a href="#local-6989586621679149452"><span class="hs-identifier hs-type hs-type">s</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149452"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="ExtraFor"><span class="annot"><a href="Mu.Servant.Server.html#ExtraFor"><span class="hs-identifier hs-var">ExtraFor</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149451"><span class="annot"><a href="#local-6989586621679149451"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Package</span></span><span> </span><span id="local-6989586621679149450"><span class="annot"><a href="#local-6989586621679149450"><span class="hs-identifier hs-type hs-type">snm</span></a></span></span><span> </span><span id="local-6989586621679149449"><span class="annot"><a href="#local-6989586621679149449"><span class="hs-identifier hs-type hs-type">mnm</span></a></span></span><span> </span><span id="local-6989586621679149448"><span class="annot"><a href="#local-6989586621679149448"><span class="hs-identifier hs-type hs-type">anm</span></a></span></span><span> </span><span id="local-6989586621679149447"><span class="annot"><a href="#local-6989586621679149447"><span class="hs-identifier hs-type hs-type">tyref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-425"></span><span>  </span><span id="ExtraFor"><span class="annot"><a href="Mu.Servant.Server.html#ExtraFor"><span class="hs-identifier hs-var">ExtraFor</span></a></span></span><span> </span><span id="local-6989586621679149446"><span class="annot"><a href="#local-6989586621679149446"><span class="hs-identifier hs-type hs-type">pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-426"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#WithAnnotatedPackageInstance"><span class="hs-identifier hs-type">WithAnnotatedPackageInstance</span></a></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149446"><span class="hs-identifier hs-type">pkg</span></a></span><span>
</span><span id="line-427"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantExtra"><span class="hs-identifier hs-type">UnwrapServantExtra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#FromMaybe"><span class="hs-identifier hs-type">FromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantAdditional"><span class="hs-identifier hs-type">ServantAdditional</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EmptyAPI</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetPackageAnnotationMay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedPackage</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149446"><span class="hs-identifier hs-type">pkg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="UnwrapServantExtra"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantExtra"><span class="hs-identifier hs-var">UnwrapServantExtra</span></a></span></span><span> </span><span id="local-6989586621679149445"><span class="annot"><a href="#local-6989586621679149445"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-430"></span><span>  </span><span id="UnwrapServantExtra"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantExtra"><span class="hs-identifier hs-var">UnwrapServantExtra</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantAdditional"><span class="hs-identifier hs-type">ServantAdditional</span></a></span><span> </span><span id="local-6989586621679149444"><span class="annot"><a href="#local-6989586621679149444"><span class="hs-identifier hs-type hs-type">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149444"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="FromMaybe"><span class="annot"><a href="Mu.Servant.Server.html#FromMaybe"><span class="hs-identifier hs-var">FromMaybe</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149443"><span class="annot"><a href="#local-6989586621679149443"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679149442"><span class="annot"><a href="#local-6989586621679149442"><span class="hs-identifier hs-type hs-type">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149441"><span class="annot"><a href="#local-6989586621679149441"><span class="hs-identifier hs-type">ma</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679149442"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679149442"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-433"></span><span>  </span><span id="FromMaybe"><span class="annot"><a href="Mu.Servant.Server.html#FromMaybe"><span class="hs-identifier hs-var">FromMaybe</span></a></span></span><span> </span><span id="local-6989586621679149440"><span class="annot"><a href="#local-6989586621679149440"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149440"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-434"></span><span>  </span><span id="FromMaybe"><span class="annot"><a href="Mu.Servant.Server.html#FromMaybe"><span class="hs-identifier hs-var">FromMaybe</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679149439"><span class="annot"><a href="#local-6989586621679149439"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149439"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="Concat"><span class="annot"><a href="Mu.Servant.Server.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149438"><span class="annot"><a href="#local-6989586621679149438"><span class="hs-keyword hs-type">as</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679149437"><span class="annot"><a href="#local-6989586621679149437"><span class="hs-identifier hs-type hs-type">k</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149436"><span class="annot"><a href="#local-6989586621679149436"><span class="hs-identifier hs-type">bs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679149437"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679149437"><span class="hs-identifier hs-type">k</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-437"></span><span>  </span><span id="Concat"><span class="annot"><a href="Mu.Servant.Server.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679149435"><span class="annot"><a href="#local-6989586621679149435"><span class="hs-identifier hs-type hs-type">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149435"><span class="hs-identifier hs-type">bs</span></a></span><span>
</span><span id="line-438"></span><span>  </span><span id="Concat"><span class="annot"><a href="Mu.Servant.Server.html#Concat"><span class="hs-identifier hs-var">Concat</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149434"><span class="annot"><a href="#local-6989586621679149434"><span class="hs-identifier hs-type hs-type">a</span></a></span></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span id="local-6989586621679149433"><span class="annot"><a href="#local-6989586621679149433"><span class="hs-keyword hs-type hs-type">as</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679149432"><span class="annot"><a href="#local-6989586621679149432"><span class="hs-identifier hs-type hs-type">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149434"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#Concat"><span class="hs-identifier hs-type">Concat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149433"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149432"><span class="hs-identifier hs-type">bs</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="PrefixRoute"><span class="annot"><a href="Mu.Servant.Server.html#PrefixRoute"><span class="hs-identifier hs-var">PrefixRoute</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149431"><span class="annot"><a href="#local-6989586621679149431"><span class="hs-identifier hs-type">prefix</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679149430"><span class="annot"><a href="#local-6989586621679149430"><span class="hs-identifier hs-type">route</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-441"></span><span>  </span><span id="PrefixRoute"><span class="annot"><a href="Mu.Servant.Server.html#PrefixRoute"><span class="hs-identifier hs-var">PrefixRoute</span></a></span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679149429"><span class="annot"><a href="#local-6989586621679149429"><span class="hs-identifier hs-type hs-type">route</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149429"><span class="hs-identifier hs-type">route</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span id="PrefixRoute"><span class="annot"><a href="Mu.Servant.Server.html#PrefixRoute"><span class="hs-identifier hs-var">PrefixRoute</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149428"><span class="annot"><a href="#local-6989586621679149428"><span class="hs-identifier hs-type hs-type">p</span></a></span></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span id="local-6989586621679149427"><span class="annot"><a href="#local-6989586621679149427"><span class="hs-identifier hs-type hs-type">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679149426"><span class="annot"><a href="#local-6989586621679149426"><span class="hs-identifier hs-type hs-type">route</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149428"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#PrefixRoute"><span class="hs-identifier hs-type">PrefixRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149427"><span class="hs-identifier hs-type">rest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149426"><span class="hs-identifier hs-type">route</span></a></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-comment">-- | ServantContentTypes represents that acceptable content types that can be used when a message in encoded:</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- 1. in a unary (non-streaming) HTTP request\/response body,</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- 2. encoded in a streaming HTTP request\/response body.</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- It is used as an `AnnotatedSchema` domain.</span><span>
</span><span id="line-448"></span><span class="hs-keyword">data</span><span> </span><span id="ServantContentTypes"><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-var">ServantContentTypes</span></a></span></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ServantContentTypes"><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-var">ServantContentTypes</span></a></span></span><span>
</span><span id="line-450"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="unary"><span class="annot"><span class="annottext">ServantContentTypes -&gt; [*]
</span><a href="Mu.Servant.Server.html#unary"><span class="hs-identifier hs-var hs-var">unary</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span>
</span><span id="line-451"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="stream"><span class="annot"><span class="annottext">ServantContentTypes -&gt; Maybe ServantStreamContentType
</span><a href="Mu.Servant.Server.html#stream"><span class="hs-identifier hs-var hs-var">stream</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantStreamContentType"><span class="hs-identifier hs-type">ServantStreamContentType</span></a></span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-keyword">type</span><span> </span><span id="DefaultServantContentTypes"><span class="annot"><a href="Mu.Servant.Server.html#DefaultServantContentTypes"><span class="hs-identifier hs-var">DefaultServantContentTypes</span></a></span></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">JSON</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantStreamContentType"><span class="hs-identifier hs-type">ServantStreamContentType</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NewlineFraming</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span class="hs-keyword">data</span><span> </span><span id="ServantStreamContentType"><span class="annot"><a href="Mu.Servant.Server.html#ServantStreamContentType"><span class="hs-identifier hs-var">ServantStreamContentType</span></a></span></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ServantStreamContentType"><span class="annot"><a href="Mu.Servant.Server.html#ServantStreamContentType"><span class="hs-identifier hs-var">ServantStreamContentType</span></a></span></span><span>
</span><span id="line-459"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="framing"><span class="annot"><span class="annottext">ServantStreamContentType -&gt; *
</span><a href="Mu.Servant.Server.html#framing"><span class="hs-identifier hs-var hs-var">framing</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span>
</span><span id="line-460"></span><span>        </span><span id="streamContentType"><span class="annot"><span class="annottext">ServantStreamContentType -&gt; *
</span><a href="Mu.Servant.Server.html#streamContentType"><span class="hs-identifier hs-var hs-var">streamContentType</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span>
</span><span id="line-461"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-comment">-- extracts a StdMethod from a ServantMethod annotation of a given method, defaulting to POST if such an annotation doesn't exist</span><span>
</span><span id="line-464"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="HttpMethodFor"><span class="annot"><a href="Mu.Servant.Server.html#HttpMethodFor"><span class="hs-identifier hs-var">HttpMethodFor</span></a></span></span><span> </span><span id="local-6989586621679149418"><span class="annot"><a href="#local-6989586621679149418"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679149417"><span class="annot"><a href="#local-6989586621679149417"><span class="hs-identifier hs-type">sname</span></a></span></span><span> </span><span id="local-6989586621679149416"><span class="annot"><a href="#local-6989586621679149416"><span class="hs-identifier hs-type">mname</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdMethod</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-465"></span><span>  </span><span id="HttpMethodFor"><span class="annot"><a href="Mu.Servant.Server.html#HttpMethodFor"><span class="hs-identifier hs-var">HttpMethodFor</span></a></span></span><span> </span><span id="local-6989586621679149415"><span class="annot"><a href="#local-6989586621679149415"><span class="hs-identifier hs-type hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679149414"><span class="annot"><a href="#local-6989586621679149414"><span class="hs-identifier hs-type hs-type">sname</span></a></span></span><span> </span><span id="local-6989586621679149413"><span class="annot"><a href="#local-6989586621679149413"><span class="hs-identifier hs-type hs-type">mname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#WithAnnotatedPackageInstance"><span class="hs-identifier hs-type">WithAnnotatedPackageInstance</span></a></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149415"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-467"></span><span>      </span><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantMethod"><span class="hs-identifier hs-type">UnwrapServantMethod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#FromMaybe"><span class="hs-identifier hs-type">FromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">POST</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetMethodAnnotationMay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedPackage</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149415"><span class="hs-identifier hs-type">pkg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149414"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149413"><span class="hs-identifier hs-type">mname</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="UnwrapServantMethod"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantMethod"><span class="hs-identifier hs-var">UnwrapServantMethod</span></a></span></span><span> </span><span id="local-6989586621679149410"><span class="annot"><a href="#local-6989586621679149410"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-471"></span><span>  </span><span id="UnwrapServantMethod"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantMethod"><span class="hs-identifier hs-var">UnwrapServantMethod</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679149409"><span class="annot"><a href="#local-6989586621679149409"><span class="hs-identifier hs-type hs-type">m</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149409"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span class="hs-comment">-- extracts the HTTP status code from the ServantStatus annotation of a given method, or defaults to 200 if such an annotation doesn't exist</span><span>
</span><span id="line-474"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="HttpStatusFor"><span class="annot"><a href="Mu.Servant.Server.html#HttpStatusFor"><span class="hs-identifier hs-var">HttpStatusFor</span></a></span></span><span> </span><span id="local-6989586621679149408"><span class="annot"><a href="#local-6989586621679149408"><span class="hs-identifier hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679149407"><span class="annot"><a href="#local-6989586621679149407"><span class="hs-identifier hs-type">sname</span></a></span></span><span> </span><span id="local-6989586621679149406"><span class="annot"><a href="#local-6989586621679149406"><span class="hs-identifier hs-type">mname</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-475"></span><span>  </span><span id="HttpStatusFor"><span class="annot"><a href="Mu.Servant.Server.html#HttpStatusFor"><span class="hs-identifier hs-var">HttpStatusFor</span></a></span></span><span> </span><span id="local-6989586621679149405"><span class="annot"><a href="#local-6989586621679149405"><span class="hs-identifier hs-type hs-type">pkg</span></a></span></span><span> </span><span id="local-6989586621679149404"><span class="annot"><a href="#local-6989586621679149404"><span class="hs-identifier hs-type hs-type">sname</span></a></span></span><span> </span><span id="local-6989586621679149403"><span class="annot"><a href="#local-6989586621679149403"><span class="hs-identifier hs-type hs-type">mname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#WithAnnotatedPackageInstance"><span class="hs-identifier hs-type">WithAnnotatedPackageInstance</span></a></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149405"><span class="hs-identifier hs-type">pkg</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-477"></span><span>      </span><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantStatus"><span class="hs-identifier hs-type">UnwrapServantStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Mu.Servant.Server.html#FromMaybe"><span class="hs-identifier hs-type">FromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="annot"><span class="hs-number">200</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetMethodAnnotationMay</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedPackage</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149405"><span class="hs-identifier hs-type">pkg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149404"><span class="hs-identifier hs-type">sname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149403"><span class="hs-identifier hs-type">mname</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="UnwrapServantStatus"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantStatus"><span class="hs-identifier hs-var">UnwrapServantStatus</span></a></span></span><span> </span><span id="local-6989586621679149401"><span class="annot"><a href="#local-6989586621679149401"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-481"></span><span>  </span><span id="UnwrapServantStatus"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantStatus"><span class="hs-identifier hs-var">UnwrapServantStatus</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantRoute"><span class="hs-identifier hs-type">ServantRoute</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679149400"><span class="annot"><a href="#local-6989586621679149400"><span class="hs-identifier hs-type hs-type">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149400"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="hs-comment">-- extracts a list of content types from a ServantUnaryContentTypes annotation of a given method</span><span>
</span><span id="line-484"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="UnaryContentTypesFor"><span class="annot"><a href="Mu.Servant.Server.html#UnaryContentTypesFor"><span class="hs-identifier hs-var">UnaryContentTypesFor</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149399"><span class="annot"><a href="#local-6989586621679149399"><span class="hs-identifier hs-type">tyRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span id="local-6989586621679149398"><span class="annot"><a href="#local-6989586621679149398"><span class="hs-identifier hs-type hs-type">sname</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-485"></span><span>  </span><span id="UnaryContentTypesFor"><span class="annot"><a href="Mu.Servant.Server.html#UnaryContentTypesFor"><span class="hs-identifier hs-var">UnaryContentTypesFor</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">SchemaRef</span></span><span> </span><span id="local-6989586621679149396"><span class="annot"><a href="#local-6989586621679149396"><span class="hs-identifier hs-type hs-type">schema</span></a></span></span><span> </span><span id="local-6989586621679149395"><span class="annot"><a href="#local-6989586621679149395"><span class="hs-identifier hs-type hs-type">typeName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#WithAnnotatedSchemaInstance"><span class="hs-identifier hs-type">WithAnnotatedSchemaInstance</span></a></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149396"><span class="hs-identifier hs-type">schema</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-487"></span><span>      </span><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantUnaryContentType"><span class="hs-identifier hs-type">UnwrapServantUnaryContentType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetTypeAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedSchema</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149396"><span class="hs-identifier hs-type">schema</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149395"><span class="hs-identifier hs-type">typeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="UnwrapServantUnaryContentType"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantUnaryContentType"><span class="hs-identifier hs-var">UnwrapServantUnaryContentType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149392"><span class="annot"><a href="#local-6989586621679149392"><span class="hs-identifier hs-type">sctype</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-491"></span><span>  </span><span id="UnwrapServantUnaryContentType"><span class="annot"><a href="Mu.Servant.Server.html#UnwrapServantUnaryContentType"><span class="hs-identifier hs-var">UnwrapServantUnaryContentType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span id="local-6989586621679149391"><span class="annot"><a href="#local-6989586621679149391"><span class="hs-identifier hs-type hs-type">ctype</span></a></span></span><span> </span><span id="local-6989586621679149390"><span class="annot"><a href="#local-6989586621679149390"><span class="hs-identifier hs-type hs-type">stype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149391"><span class="hs-identifier hs-type">ctype</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="hs-comment">-- extracts a content type from a ServantStreamContentType annotation of a given method</span><span>
</span><span id="line-494"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="StreamContentTypeFor"><span class="annot"><a href="Mu.Servant.Server.html#StreamContentTypeFor"><span class="hs-identifier hs-var">StreamContentTypeFor</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149389"><span class="annot"><a href="#local-6989586621679149389"><span class="hs-identifier hs-type">tyRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span id="local-6989586621679149388"><span class="annot"><a href="#local-6989586621679149388"><span class="hs-identifier hs-type hs-type">sname</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-495"></span><span>  </span><span id="StreamContentTypeFor"><span class="annot"><a href="Mu.Servant.Server.html#StreamContentTypeFor"><span class="hs-identifier hs-var">StreamContentTypeFor</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">SchemaRef</span></span><span> </span><span id="local-6989586621679149387"><span class="annot"><a href="#local-6989586621679149387"><span class="hs-identifier hs-type hs-type">schema</span></a></span></span><span> </span><span id="local-6989586621679149386"><span class="annot"><a href="#local-6989586621679149386"><span class="hs-identifier hs-type hs-type">typeName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-496"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#WithAnnotatedSchemaInstance"><span class="hs-identifier hs-type">WithAnnotatedSchemaInstance</span></a></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149387"><span class="hs-identifier hs-type">schema</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-497"></span><span>      </span><span class="annot"><a href="Mu.Servant.Server.html#StreamContentType"><span class="hs-identifier hs-type">StreamContentType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetTypeAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedSchema</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149387"><span class="hs-identifier hs-type">schema</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149386"><span class="hs-identifier hs-type">typeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="StreamContentType"><span class="annot"><a href="Mu.Servant.Server.html#StreamContentType"><span class="hs-identifier hs-var">StreamContentType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149384"><span class="annot"><a href="#local-6989586621679149384"><span class="hs-identifier hs-type">sct</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-501"></span><span>  </span><span id="StreamContentType"><span class="annot"><a href="Mu.Servant.Server.html#StreamContentType"><span class="hs-identifier hs-var">StreamContentType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;missing stream content type&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>  </span><span id="StreamContentType"><span class="annot"><a href="Mu.Servant.Server.html#StreamContentType"><span class="hs-identifier hs-var">StreamContentType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantStreamContentType"><span class="hs-identifier hs-type">ServantStreamContentType</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679149383"><span class="annot"><a href="#local-6989586621679149383"><span class="hs-identifier hs-type hs-type">ctype</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149383"><span class="hs-identifier hs-type">ctype</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="hs-comment">-- extracts a framing from a ServantStreamContentType annotation of a given method</span><span>
</span><span id="line-506"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="StreamFramingFor"><span class="annot"><a href="Mu.Servant.Server.html#StreamFramingFor"><span class="hs-identifier hs-var">StreamFramingFor</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149382"><span class="annot"><a href="#local-6989586621679149382"><span class="hs-identifier hs-type">tyRef</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeRef</span></span><span> </span><span id="local-6989586621679149381"><span class="annot"><a href="#local-6989586621679149381"><span class="hs-identifier hs-type hs-type">sname</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-507"></span><span>  </span><span id="StreamFramingFor"><span class="annot"><a href="Mu.Servant.Server.html#StreamFramingFor"><span class="hs-identifier hs-var">StreamFramingFor</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">SchemaRef</span></span><span> </span><span id="local-6989586621679149380"><span class="annot"><a href="#local-6989586621679149380"><span class="hs-identifier hs-type hs-type">schema</span></a></span></span><span> </span><span id="local-6989586621679149379"><span class="annot"><a href="#local-6989586621679149379"><span class="hs-identifier hs-type hs-type">typeName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-508"></span><span>    </span><span class="annot"><a href="Mu.Servant.Server.html#WithAnnotatedSchemaInstance"><span class="hs-identifier hs-type">WithAnnotatedSchemaInstance</span></a></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149380"><span class="hs-identifier hs-type">schema</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-509"></span><span>      </span><span class="annot"><a href="Mu.Servant.Server.html#StreamFraming"><span class="hs-identifier hs-type">StreamFraming</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetTypeAnnotation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AnnotatedSchema</span></span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679149380"><span class="hs-identifier hs-type">schema</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679149379"><span class="hs-identifier hs-type">typeName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="StreamFraming"><span class="annot"><a href="Mu.Servant.Server.html#StreamFraming"><span class="hs-identifier hs-var">StreamFraming</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679149377"><span class="annot"><a href="#local-6989586621679149377"><span class="hs-identifier hs-type">sct</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-513"></span><span>  </span><span id="StreamFraming"><span class="annot"><a href="Mu.Servant.Server.html#StreamFraming"><span class="hs-identifier hs-var">StreamFraming</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeError</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><span class="hs-string">&quot;missing stream content type&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>  </span><span id="StreamFraming"><span class="annot"><a href="Mu.Servant.Server.html#StreamFraming"><span class="hs-identifier hs-var">StreamFraming</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantContentTypes"><span class="hs-identifier hs-type">ServantContentTypes</span></a></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Mu.Servant.Server.html#ServantStreamContentType"><span class="hs-identifier hs-type">ServantStreamContentType</span></a></span><span> </span><span id="local-6989586621679149376"><span class="annot"><a href="#local-6989586621679149376"><span class="hs-identifier hs-type hs-type">framing</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679149376"><span class="hs-identifier hs-type">framing</span></a></span><span>
</span><span id="line-516"></span></pre></body></html>